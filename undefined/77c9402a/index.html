<!DOCTYPE html>
<html lang="zh-CN">
<head><!-- hexo injector head_begin start --><style type="text/css">.douban-card-block {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-height: 400px;
}

.douban-card {
    display: flex;
    margin: 30px 10px;
    padding: 15px;
    border-radius: 15px;
    position: relative;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    color: antiquewhite;
    text-decoration: none;
}

.douban-card:hover {
    text-decoration: none;
}

.douban-card-bgimg {
    position: absolute;
    width: 115%;
    height: 115%;
    filter: blur(15px) brightness(0.6);
    background-size: 100%;
    background-position: center;
    background-repeat: no-repeat;
}

.douban-card-img {
    position: relative;
    height: 130px;
    width: 80px;
    background-size: 100%;
    background-position: center;
    background-repeat: no-repeat;
}

.douban-card-left:hover .douban-card-img {
    filter: blur(5px) brightness(0.6);
    transform: perspective(800px) rotateX(180deg);
}

.douban-card-left .douban-card-img {
    transition: all 500ms ease;
}

.douban-card-left {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.douban-card-left .douban-card-status {
    height: 130px;
    width: 80px;
    text-align: center;
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 30%;
    transform: rotateX(180deg);
    backface-visibility: hidden;
    transition: all 500ms ease;
}

.douban-card-left:hover .douban-card-status {
    transform: perspective(800px) rotateX(0deg);
}

.douban-card-right {
    position: relative;
    display: flex;
    flex-direction: column;
    margin-left: 12px;
    font-size: 16px;
    font-family: "Courier New", Courier, monospace;
    line-height: 1.3;
    color: antiquewhite;
}

.douban-card-item {
    margin-top: 4px;
}
</style><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/Dinosaur.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/Dinosaur.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"dlrdaile.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这篇文章整理了ROS2开发过程中常用的代码段，包括ament_cmake编写、话题相关、服务相关等，主要内容翻译自官方教程。">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS2常用代码段">
<meta property="og:url" content="https://dlrdaile.github.io/undefined/77c9402a/index.html">
<meta property="og:site_name" content="A乐小屋">
<meta property="og:description" content="这篇文章整理了ROS2开发过程中常用的代码段，包括ament_cmake编写、话题相关、服务相关等，主要内容翻译自官方教程。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dlrdaile.github.io/undefined/77c9402a/ROS2%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5.assets/image-20220814091211622.png">
<meta property="og:image" content="https://dlrdaile.github.io/undefined/77c9402a/ROS2%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5.assets/image-20220814091328378.png">
<meta property="og:image" content="https://dlrdaile.github.io/undefined/77c9402a/ROS2%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5.assets/image-20220814095727267.png">
<meta property="og:image" content="https://dl-poke.oss-cn-beijing.aliyuncs.com/pokeimage-20220815100951291.png">
<meta property="article:published_time" content="2024-08-21T02:50:34.000Z">
<meta property="article:modified_time" content="2025-02-17T02:34:23.685Z">
<meta property="article:author" content="dl">
<meta property="article:tag" content="ROS2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dlrdaile.github.io/undefined/77c9402a/ROS2%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5.assets/image-20220814091211622.png">


<link rel="canonical" href="https://dlrdaile.github.io/undefined/77c9402a/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dlrdaile.github.io/undefined/77c9402a/","path":"undefined/77c9402a/","title":"ROS2常用代码段"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ROS2常用代码段 | A乐小屋</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">A乐小屋</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">16</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">16</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">37</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ros2%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5"><span class="nav-number">1.</span> <span class="nav-text">ROS2常用代码段</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ament_cmake%E7%BC%96%E5%86%99"><span class="nav-number">1.1.</span> <span class="nav-text">ament_cmake编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="nav-number">1.1.1.</span> <span class="nav-text">创建功能包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.2.</span> <span class="nav-text">一般的编写方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%93%E7%BC%96%E5%86%99"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">库编写</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%BA%93"><span class="nav-number">1.1.2.1.1.</span> <span class="nav-text">添加库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">1.1.2.1.2.</span> <span class="nav-text">链接依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E4%BE%9D%E8%B5%96"><span class="nav-number">1.1.2.1.3.</span> <span class="nav-text">导出依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#package.xml"><span class="nav-number">1.1.2.1.4.</span> <span class="nav-text">package.xml</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BA%93"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">使用自定义的库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E5%BA%93"><span class="nav-number">1.1.2.2.1.</span> <span class="nav-text">查找库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.2.2.2.</span> <span class="nav-text">生成可执行文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">1.1.2.2.3.</span> <span class="nav-text">链接库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.2.2.4.</span> <span class="nav-text">安装可执行文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#package.xml-1"><span class="nav-number">1.1.2.2.5.</span> <span class="nav-text">package.xml</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ament_cmake_auto%E7%AE%80%E5%8C%96"><span class="nav-number">1.1.3.</span> <span class="nav-text">使用ament_cmake_auto简化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%93%E7%BC%96%E5%86%99-1"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">库编写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ament_cmake_auto%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%8F%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">ament_cmake_auto的一些宏接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#section"><span class="nav-number">1.1.3.2.1.</span> <span class="nav-text">*</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#section-1"><span class="nav-number">1.1.3.2.2.</span> <span class="nav-text">*</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ament_auto_find_build_dependencies"><span class="nav-number">1.1.3.2.3.</span> <span class="nav-text">ament_auto_find_build_dependencies</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ament_auto_package"><span class="nav-number">1.1.3.2.4.</span> <span class="nav-text">ament_auto_package</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#section-2"><span class="nav-number">1.1.3.2.5.</span> <span class="nav-text">*</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ament_cmake_python%E9%9B%86%E6%88%90cpp%E5%92%8Cpython"><span class="nav-number">1.1.4.</span> <span class="nav-text">使用ament_cmake_python集成cpp和python</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEpackage.xml"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">配置package.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEcmakelists.txt"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">配置CMakeLists.txt</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E9%83%A8%E5%88%86"><span class="nav-number">1.1.4.2.1.</span> <span class="nav-text">依赖部分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cpp%E9%83%A8%E5%88%86"><span class="nav-number">1.1.4.2.2.</span> <span class="nav-text">CPP部分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#python%E9%83%A8%E5%88%86"><span class="nav-number">1.1.4.2.3.</span> <span class="nav-text">python部分</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3api"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">相关API</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ament_get_python_install_dir"><span class="nav-number">1.1.4.3.1.</span> <span class="nav-text">ament_get_python_install_dir</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ament_python_install_module"><span class="nav-number">1.1.4.3.2.</span> <span class="nav-text">ament_python_install_module</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ament_python_install_package"><span class="nav-number">1.1.4.3.3.</span> <span class="nav-text">ament_python_install_package</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%93"><span class="nav-number">1.1.5.</span> <span class="nav-text">简单示例的完整体</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">1.1.5.1.</span> <span class="nav-text">目录结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cmakelists.txt"><span class="nav-number">1.1.5.2.</span> <span class="nav-text">CMakeLists.txt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#package.xml-2"><span class="nav-number">1.1.5.3.</span> <span class="nav-text">package.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#scriptsli4.py"><span class="nav-number">1.1.5.4.</span> <span class="nav-text">scripts&#x2F;li4.py</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ament_python%E7%9A%84%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">ament_python的编写方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">创建功能包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E8%8A%82%E7%82%B9%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.2.</span> <span class="nav-text">编写节点文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8package.xml%E4%B8%AD%E8%A1%A5%E5%85%85%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BE%9D%E8%B5%96"><span class="nav-number">1.2.3.</span> <span class="nav-text">在package.xml中补充运行时依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9%E5%85%A5%E5%8F%A3"><span class="nav-number">1.2.4.</span> <span class="nav-text">添加节点入口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5setup.cfg"><span class="nav-number">1.2.5.</span> <span class="nav-text">检查setup.cfg</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E7%9B%B8%E5%85%B3"><span class="nav-number">1.3.</span> <span class="nav-text">话题相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="nav-number">1.3.1.</span> <span class="nav-text">开发流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpp"><span class="nav-number">1.3.2.</span> <span class="nav-text">CPP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E8%80%85"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">发布者</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A2%E9%98%85%E8%80%85"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">订阅者</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python"><span class="nav-number">1.3.3.</span> <span class="nav-text">Python</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E8%80%85-1"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">发布者</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A2%E9%98%85%E8%80%85-1"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">订阅者</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3"><span class="nav-number">1.4.</span> <span class="nav-text">服务相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E6%B5%81%E7%A8%8B"><span class="nav-number">1.4.1.</span> <span class="nav-text">代码编写流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B5%81%E7%A8%8B"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">服务端流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%81%E7%A8%8B"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">客户端流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpp%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8%E4%BA%86%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B%E7%9A%84%E7%BC%96%E5%86%99%E6%96%B9%E5%BC%8F"><span class="nav-number">1.4.2.</span> <span class="nav-text">CPP(这里使用了面向过程的编写方式)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">服务端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">客户端</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python-1"><span class="nav-number">1.4.3.</span> <span class="nav-text">Python</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF-1"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-number">1.4.3.1.1.</span> <span class="nav-text">类型定义</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.4.3.1.1.1.</span> <span class="nav-text">内置数据类型</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E8%A1%A8%E6%A0%BC%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.4.3.1.1.2.</span> <span class="nav-text">内置表格类型</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.4.3.1.1.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-number">1.4.3.1.2.</span> <span class="nav-text">默认值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="nav-number">1.4.3.1.3.</span> <span class="nav-text">常数定义</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E7%BC%96%E8%AF%91%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">编写编译文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9"><span class="nav-number">1.4.3.2.1.</span> <span class="nav-text">核心内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#package.xml-3"><span class="nav-number">1.4.3.2.2.</span> <span class="nav-text">package.xml</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cmakelists.txt-1"><span class="nav-number">1.4.3.2.3.</span> <span class="nav-text">CMakeLists.txt</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8colcon%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">使用colcon生成接口文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E4%BB%A5vscode%E4%B8%AD%E4%B8%BA%E4%BE%8B"><span class="nav-number">1.4.4.</span> <span class="nav-text">自定义接口文件使用方法(以vscode中为例)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E4%B8%8D%E5%90%8C%E5%8A%9F%E8%83%BD%E5%8C%85%E4%B8%8B%E7%9A%84%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">在与接口定义不同功能包下的调用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E7%9B%B8%E5%90%8C%E5%8A%9F%E8%83%BD%E5%8C%85%E4%B8%8B%E7%9A%84%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">在与接口定义相同功能包下的调用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">1.4.4.2.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8A%9F%E8%83%BD%E5%8C%85%E4%B8%8B%E4%BD%BF%E7%94%A8%E8%AF%A5%E5%8A%9F%E8%83%BD%E5%8C%85%E7%9A%84msg%E5%B0%81%E8%A3%85%E5%8F%A6%E4%B8%80%E4%B8%AAmsg"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">在同一功能包下使用该功能包的msg封装另一个msg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vscode%E4%B8%AD%E4%BB%A3%E7%A0%81%E8%A1%A5%E5%85%A8%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">vscode中代码补全的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#cpp%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.4.4.1.</span> <span class="nav-text">cpp相关配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#python%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.4.4.2.</span> <span class="nav-text">python相关配置</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3"><span class="nav-number">1.5.</span> <span class="nav-text">参数相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#api%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.5.1.</span> <span class="nav-text">API接口：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpp-1"><span class="nav-number">1.5.2.</span> <span class="nav-text">CPP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python-2"><span class="nav-number">1.5.3.</span> <span class="nav-text">Python</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%B5%8B%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96"><span class="nav-number">1.5.4.</span> <span class="nav-text">监测参数的变化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E7%9B%B8%E5%85%B3"><span class="nav-number">1.6.</span> <span class="nav-text">动作相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E7%9A%84%E4%BD%9C%E7%94%A8%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.6.1.</span> <span class="nav-text">动作的作用描述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">服务端的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">客户端的作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E8%BF%87%E7%A8%8B%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">状态过程描述</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpp%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.6.2.</span> <span class="nav-text">CPP实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">动作服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85-2"><span class="nav-number">1.6.2.1.1.</span> <span class="nav-text">创建功能包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.2.1.2.</span> <span class="nav-text">编写服务端代码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E5%8A%A8%E4%BD%9C%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E5%85%AD%E4%B8%AA%E9%83%A8%E5%88%86"><span class="nav-number">1.6.2.1.2.1.</span> <span class="nav-text">一个动作服务器需要六个部分</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.2.1.2.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">动作客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.2.2.1.</span> <span class="nav-text">编写客户端代码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E5%8A%A8%E4%BD%9C%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%89%E4%B8%89%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E4%BA%8B%E6%83%85"><span class="nav-number">1.6.2.2.1.1.</span> <span class="nav-text">一个动作客户端有三个重要的事情:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">1.6.2.2.1.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.6.3.</span> <span class="nav-text">Python实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E6%9C%8D%E5%8A%A1%E5%99%A8-1"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">动作服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E5%AE%A2%E6%88%B7%E7%AB%AF-1"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">动作客户端</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pluginlib%E7%9A%84%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95"><span class="nav-number">1.7.</span> <span class="nav-text">pluginlib的编写方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85pluginlib"><span class="nav-number">1.7.1.</span> <span class="nav-text">安装pluginlib</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">1.7.2.</span> <span class="nav-text">使用流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%9F%BA%E7%B1%BB%E5%BA%93%E6%96%87%E4%BB%B6"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">编写基类库文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E5%8C%85"><span class="nav-number">1.7.2.1.1.</span> <span class="nav-text">创建工作包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9F%BA%E7%B1%BB%E5%BA%93%E5%A4%B4%E6%96%87%E4%BB%B6%E5%B9%B6%E7%BC%96%E5%86%99"><span class="nav-number">1.7.2.1.2.</span> <span class="nav-text">创建基类库头文件并编写</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E5%86%99cmakelist.txt"><span class="nav-number">1.7.2.1.3.</span> <span class="nav-text">编写CmakeList.txt</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#colcon-build%E8%BF%9B%E8%A1%8C%E5%9F%BA%E7%B1%BB%E5%BA%93%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="nav-number">1.7.2.1.4.</span> <span class="nav-text">colcon
build进行基类库文件安装</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6%E5%BA%93%E6%96%87%E4%BB%B6%E7%BB%A7%E6%89%BF%E7%B1%BB"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">编写插件库文件(继承类)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E5%8C%85-1"><span class="nav-number">1.7.2.2.1.</span> <span class="nav-text">创建工作包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6%E5%BA%93%E6%96%87%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="nav-number">1.7.2.2.2.</span> <span class="nav-text">编写插件库文件的代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6%E5%A3%B0%E6%98%8Exml"><span class="nav-number">1.7.2.2.3.</span> <span class="nav-text">编写插件声明XML</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEcmakelist.txt"><span class="nav-number">1.7.2.2.4.</span> <span class="nav-text">配置CmakeList.txt</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#colcon-build%E8%BF%9B%E8%A1%8C%E6%8F%92%E4%BB%B6%E7%B1%BB%E5%BA%93%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="nav-number">1.7.2.2.5.</span> <span class="nav-text">colcon
build进行插件类库文件安装</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">使用插件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#colcon-build%E8%BF%9B%E8%A1%8C%E5%8F%AF%E6%89%A7%E8%A1%8C%E8%8A%82%E7%82%B9%E7%9A%84%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-number">1.7.2.3.1.</span> <span class="nav-text">colcon
build进行可执行节点的编译安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E8%8A%82%E7%82%B9"><span class="nav-number">1.7.2.3.2.</span> <span class="nav-text">运行节点</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#launch%E6%96%87%E4%BB%B6%E7%9A%84%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.</span> <span class="nav-text">launch文件的编写方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%8F%8A%E5%8A%9F%E8%83%BD%E5%8C%85%E5%86%85%E4%B8%8B%E8%BD%BD%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.1.</span> <span class="nav-text">目录结构及功能包内下载方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ament_python%E7%BB%93%E6%9E%84"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">ament_python结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.8.1.1.1.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.1.1.2.</span> <span class="nav-text">下载方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ament_cmake%E7%BB%93%E6%9E%84"><span class="nav-number">1.8.1.2.</span> <span class="nav-text">ament_cmake结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84-1"><span class="nav-number">1.8.1.2.1.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%B9%E6%B3%95-1"><span class="nav-number">1.8.1.2.2.</span> <span class="nav-text">下载方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8python%E8%BF%9B%E8%A1%8C%E7%BC%96%E5%86%99"><span class="nav-number">1.8.2.</span> <span class="nav-text">使用python进行编写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5substitutions%E5%AE%9E%E7%8E%B0launch%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">导入substitutions实现launch文件的参数配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.8.2.1.1.</span> <span class="nav-text">使用场景</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9Btip%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.8.3.</span> <span class="nav-text">使用过程中的一些tip和注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">调用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E8%AE%AE%E5%9C%A8package.xml%E4%B8%AD%E5%86%99%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">1.8.3.2.</span> <span class="nav-text">建议在package.xml中写入依赖</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#executor%E7%9B%B8%E5%85%B3"><span class="nav-number">1.9.</span> <span class="nav-text">Executor相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">1.9.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#types-of-executors"><span class="nav-number">1.9.2.</span> <span class="nav-text">Types of Executors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#callback-groups"><span class="nav-number">1.9.3.</span> <span class="nav-text">Callback groups</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%8D%E7%B1%BB"><span class="nav-number">1.9.3.1.</span> <span class="nav-text">种类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.9.3.2.</span> <span class="nav-text">使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#c"><span class="nav-number">1.9.3.2.1.</span> <span class="nav-text">c++</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#python-3"><span class="nav-number">1.9.3.2.2.</span> <span class="nav-text">python</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%9D%E5%A4%96%E8%AF%B4%E6%98%8E"><span class="nav-number">1.9.3.3.</span> <span class="nav-text">额外说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%A4%84%E7%90%86%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.9.4.</span> <span class="nav-text">默认处理顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8Eros1%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB"><span class="nav-number">1.9.5.</span> <span class="nav-text">与ROS1的区别与联系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-1"><span class="nav-number">1.9.6.</span> <span class="nav-text">使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.9.6.1.</span> <span class="nav-text">最简单的使用程序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#components"><span class="nav-number">1.10.</span> <span class="nav-text">Components</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.10.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95-2"><span class="nav-number">1.10.2.</span> <span class="nav-text">使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%B0%83%E7%94%A8"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">命令行调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E7%9A%84%E6%96%B9%E5%BC%8F%E8%B0%83"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">使用代码的方式调</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%B7%AF%E5%BE%84%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%96%B9%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="nav-number">1.10.2.3.</span> <span class="nav-text">使用路径加载的方式调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8launch%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.10.2.4.</span> <span class="nav-text">使用launch加载</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99component%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-number">1.10.3.</span> <span class="nav-text">编写Component动态库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85%E5%8A%A0%E4%B8%8Arclcpp_components%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="nav-number">1.10.3.1.</span> <span class="nav-text">创建功能包，加上rclcpp_components的依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99component-node%E5%BA%93%E6%96%87%E4%BB%B6%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%9B%B6%E6%8B%B7%E8%B4%9D%E9%80%9A%E8%AE%AF"><span class="nav-number">1.10.3.2.</span> <span class="nav-text">编写component node库文件(线程间零拷贝通讯)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85"><span class="nav-number">1.10.3.2.1.</span> <span class="nav-text">消费者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85"><span class="nav-number">1.10.3.2.2.</span> <span class="nav-text">生产者</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cmakelist"><span class="nav-number">1.10.3.3.</span> <span class="nav-text">CmakeList</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%86%85%E5%AE%B9"><span class="nav-number">1.10.3.3.1.</span> <span class="nav-text">关键内容</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dl"
      src="/img/Dinosaur.png">
  <p class="site-author-name" itemprop="name">dl</p>
  <div class="site-description" itemprop="description">观察着、体验着、前进着</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dlrdaile" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dlrdaile" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/dle467866@gmail.com" title="E-Mail → dle467866@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dlrdaile.github.io/undefined/77c9402a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/Dinosaur.png">
      <meta itemprop="name" content="dl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A乐小屋">
      <meta itemprop="description" content="观察着、体验着、前进着">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ROS2常用代码段 | A乐小屋">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ROS2常用代码段
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-21 10:50:34" itemprop="dateCreated datePublished" datetime="2024-08-21T10:50:34+08:00">2024-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-02-17 10:34:23" itemprop="dateModified" datetime="2025-02-17T10:34:23+08:00">2025-02-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ROS2/" itemprop="url" rel="index"><span itemprop="name">ROS2</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>41 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>这篇文章整理了ROS2开发过程中常用的代码段，包括ament_cmake编写、话题相关、服务相关等，主要内容翻译自官方教程。
<span id="more"></span></p>
<h1 id="ros2常用代码段">ROS2常用代码段</h1>
<h2 id="ament_cmake编写">ament_cmake编写</h2>
<h3 id="创建功能包">创建功能包</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create pkg_name --build-type ament_cmake</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处可以不写<code>--build-type</code>,指令默认创建的便是<code>ament_camke</code></p>
</blockquote>
<h3 id="一般的编写方法">一般的编写方法</h3>
<h4 id="库编写">库编写</h4>
<h5 id="添加库">添加库</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加源文件，生成库</span></span><br><span class="line"><span class="keyword">add_library</span>(my_math_lib SHARED</span><br><span class="line">        <span class="keyword">include</span>/my_math_lib/my_math_lib.hpp</span><br><span class="line">        src/my_math_lib.cpp</span><br><span class="line">        )</span><br><span class="line"><span class="comment"># 添加头文件地址</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(my_math_lib PUBLIC</span><br><span class="line">        $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">        $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h5 id="链接依赖">链接依赖</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用于代替传统的target_link_libraries</span></span><br><span class="line">ament_target_dependencies(my_math_lib</span><br><span class="line">        PUBLIC</span><br><span class="line">        rclcpp</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h5 id="导出依赖">导出依赖</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了使下游文件可以访问</span></span><br><span class="line">ament_export_targets(my_math_lib HAS_LIBRARY_TARGET)</span><br><span class="line">ament_export_dependencies(</span><br><span class="line">        rclcpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册 导出头文件</span></span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">        DIRECTORY <span class="keyword">include</span>/</span><br><span class="line">        DESTINATION <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册 导出库文件</span></span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">        TARGETS my_math_lib <span class="comment"># 告诉ros2有这么个目标（可执行文件或者库）</span></span><br><span class="line">        <span class="keyword">EXPORT</span> my_math_lib</span><br><span class="line">        ARCHIVE DESTINATION lib</span><br><span class="line">        LIBRARY DESTINATION lib</span><br><span class="line">        RUNTIME DESTINATION bin</span><br><span class="line">        INCLUDES DESTINATION <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line">ament_package()</span><br></pre></td></tr></table></figure>
<h5 id="package.xml">package.xml</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>my_math_lib<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>my_math_lib<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;renyunfan@outlook.com&quot;</span>&gt;</span>Yunfan Ren<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span>BSD<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用自定义的库">使用自定义的库</h4>
<h5 id="查找库">查找库</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(my_math_lib REQUIRED)</span><br></pre></td></tr></table></figure>
<h5 id="生成可执行文件">生成可执行文件</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找依赖文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(complex_test</span><br><span class="line">        src/complex_test.cpp</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h5 id="链接库">链接库</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ament_target_dependencies(complex_test</span><br><span class="line">        my_math_lib</span><br><span class="line">        rclcpp</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h5 id="安装可执行文件">安装可执行文件</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS complex_test</span><br><span class="line">        DESTINATION lib/<span class="variable">$&#123;PROJECT_NAME&#125;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="package.xml-1">package.xml</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>my_math_lib<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>my_math_lib<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;renyunfan@outlook.com&quot;</span>&gt;</span>Yunfan Ren<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span>BSD<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>my_math_lib<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用ament_cmake_auto简化">使用ament_cmake_auto简化</h3>
<h4 id="库编写-1">库编写</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">3.5</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">test</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span> (ament_cmake_auto REQUIRED) </span><br><span class="line">ament_auto_find_build_dependencies ()</span><br><span class="line"></span><br><span class="line">ament_auto_add_library ( my_lib SHARED </span><br><span class="line">    src/example.cpp </span><br><span class="line">    <span class="keyword">include</span>/example.hpp)</span><br><span class="line"></span><br><span class="line">ament_auto_package ()</span><br></pre></td></tr></table></figure>
<h4 id="ament_cmake_auto的一些宏接口">ament_cmake_auto的一些宏接口</h4>
<h5 id="section">*</h5>
<p>*<a
href="https://link.zhihu.com/?target=https%3A//github.com/ament/ament_cmake/blob/master/ament_cmake_auto/cmake/ament_auto_add_executable.cmake">ament_auto_add_executable</a>
**</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相当于</span></span><br><span class="line"><span class="keyword">add_executable</span>()</span><br><span class="line"><span class="keyword">target_include_directories</span>()</span><br><span class="line"><span class="keyword">target_link_libraries</span>()</span><br></pre></td></tr></table></figure>
<h5 id="section-1">*</h5>
<p>*<a
href="https://link.zhihu.com/?target=https%3A//github.com/ament/ament_cmake/blob/master/ament_cmake_auto/cmake/ament_auto_add_library.cmake">ament_auto_add_library</a>
**</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相当于</span></span><br><span class="line"><span class="keyword">add_library</span>()</span><br><span class="line"><span class="keyword">target_include_directories</span>()</span><br><span class="line"><span class="keyword">target_link_libraries</span>()</span><br></pre></td></tr></table></figure>
<h5 id="ament_auto_find_build_dependencies"><a
href="https://link.zhihu.com/?target=https%3A//github.com/ament/ament_cmake/blob/master/ament_cmake_auto/cmake/ament_auto_find_build_dependencies.cmake">ament_auto_find_build_dependencies</a></h5>
<blockquote>
<p>他会自动将xml中填写了的依赖给连接上，相当于不用写find_package了。</p>
</blockquote>
<h5 id="ament_auto_package"><a
href="https://link.zhihu.com/?target=https%3A//github.com/ament/ament_cmake/blob/master/ament_cmake_auto/cmake/ament_auto_package.cmake">ament_auto_package</a></h5>
<blockquote>
<p>这个用来代替以前的export和两次install，以及最后的ament_package。</p>
</blockquote>
<h5 id="section-2">*</h5>
<p>*<a
href="https://link.zhihu.com/?target=https%3A//github.com/ament/ament_cmake/blob/master/ament_cmake_auto/cmake/ament_auto_generate_code.cmake">ament_auto_generate_code</a>
**</p>
<blockquote>
<p>看起来是个很诱人的宏，感觉像是生成cfg和msg、srv之类的，不过点进去看源码，<strong>应该是还没实现</strong>。</p>
</blockquote>
<h3
id="使用ament_cmake_python集成cpp和python">使用ament_cmake_python集成cpp和python</h3>
<h4 id="配置package.xml">配置package.xml</h4>
<blockquote>
<ul>
<li>增加<code>&lt;buildtool_depend&gt;ament_cmake_python&lt;/buildtool_depend&gt;</code>行和<code>rclpy</code>，支持python使用。</li>
<li>注意：在标准的 Python 包中，你应该有 ament_python，而不是
ament_cmake_python。 确保不要混合使用这 2 个。</li>
<li>使用 ament_cmake_python 意味着我们将能够使用 cmake 设置我们的 Python
内容。</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-model href=<span class="string">&quot;http://download.ros.org/schema/package_format3.xsd&quot;</span> schematypens=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>my_cpp_py_pkg<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>TODO: Package description<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;your@email.com&quot;</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span>TODO: License declaration<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake_python<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclcpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclpy<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="配置cmakelists.txt">配置CMakeLists.txt</h4>
<h5 id="依赖部分">依赖部分</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_python REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(rclcpp REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(rclpy REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(std_msgs REQUIRED)</span><br></pre></td></tr></table></figure>
<h5 id="cpp部分">CPP部分</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Include Cpp &quot;include&quot; directory</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create Cpp executable</span></span><br><span class="line"><span class="keyword">add_executable</span>(cpp_talker src/cpp_talker.cpp)</span><br><span class="line">ament_target_dependencies(cpp_talker rclcpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Cpp executables</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS</span><br><span class="line">  cpp_talker </span><br><span class="line">  DESTINATION lib/<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="python部分">python部分</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install Python modules</span></span><br><span class="line">ament_python_install_package(<span class="variable">$&#123;PROJECT_NAME&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Python executables</span></span><br><span class="line"><span class="keyword">install</span>(PROGRAMS</span><br><span class="line">  scripts/py_listener.py</span><br><span class="line">  DESTINATION lib/<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="相关api">相关API</h4>
<h5 id="ament_get_python_install_dir">ament_get_python_install_dir</h5>
<blockquote>
<p>The CMake</p>
<p>function <a
target="_blank" rel="noopener" href="https://github.com/ament/ament_cmake/blob/master/ament_cmake_python/cmake/ament_get_python_install_dir.cmake"><code>ament_get_python_install_dir</code></a>
gets the path Python packages will be installed to. The path is always
relative to <code>CMAKE_INSTALL_PREFIX</code>.</p>
<p>The path can be customized by setting <code>PYTHON_INSTALL_DIR</code>
on the command line. It must be a relative path. For example, the cmake
command bellow would cause Python code to be installed to
<code>$&#123;CMAKE_INSTALL_PREFIX&#125;/foobar/site-packages</code>.</p>
</blockquote>
<h5 id="ament_python_install_module">ament_python_install_module</h5>
<blockquote>
<p>The CMake</p>
<p>macro <a
target="_blank" rel="noopener" href="https://github.com/ament/ament_cmake/blob/master/ament_cmake_python/cmake/ament_python_install_module.cmake"><code>ament_python_install_module</code></a>
will install a single Python module to the Python install directory.</p>
</blockquote>
<h5 id="ament_python_install_package">ament_python_install_package</h5>
<blockquote>
<p>The CMake</p>
<p>macro <a
target="_blank" rel="noopener" href="https://github.com/ament/ament_cmake/blob/master/ament_cmake_python/cmake/ament_python_install_package.cmake"><code>ament_python_install_package</code></a>
will install a Python package and all subpackages to the Python install
directory.</p>
</blockquote>
<h3 id="简单示例的完整体">简单示例的完整体</h3>
<h4 id="目录结构">目录结构</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">└── test_cpp_python</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    ├── include</span><br><span class="line">    │   └── test_cpp_python</span><br><span class="line">    ├── package.xml</span><br><span class="line">    ├── scripts</span><br><span class="line">    │   └── li4.py</span><br><span class="line">    └── src</span><br><span class="line">        └── wang2.cpp</span><br></pre></td></tr></table></figure>
<h4 id="cmakelists.txt">CMakeLists.txt</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(test_cpp_python)</span><br><span class="line"></span><br><span class="line"><span class="comment"># find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_auto REQUIRED)</span><br><span class="line">ament_auto_find_build_dependencies()</span><br><span class="line"></span><br><span class="line">ament_auto_add_executable(wang src/wang2.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Python executables</span></span><br><span class="line"><span class="keyword">install</span>(PROGRAMS</span><br><span class="line">  scripts/li4.py</span><br><span class="line">  DESTINATION lib/<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br><span class="line">ament_auto_package()</span><br></pre></td></tr></table></figure>
<h4 id="package.xml-2">package.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-model href=<span class="string">&quot;http://download.ros.org/schema/package_format3.xsd&quot;</span> schematypens=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>test_cpp_python<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>TODO: Package description<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;dllr@todo.todo&quot;</span>&gt;</span>dllr<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span>TODO: License declaration<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake_auto<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake_python<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclcpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclpy<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="scriptsli4.py">scripts/li4.py</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">123123</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，py文件中一定要记得添加第一行，否则会报错</p>
</blockquote>
<h2 id="ament_python的编写方法">ament_python的编写方法</h2>
<h3 id="创建功能包-1">创建功能包</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create pkg_name --build-type ament_python</span><br></pre></td></tr></table></figure>
<h3 id="编写节点文件">编写节点文件</h3>
<p>在<code>pkg_name/pkg_name</code>下创建<code>xxx.py</code>文件，该目录下会自动生成一个<code>__init__.py</code>文件，说明这个目录下是一个python包</p>
<h3
id="在package.xml中补充运行时依赖">在<code>package.xml</code>中补充运行时依赖</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rclpy<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>通常写在<code>exec_depend</code>标签下即可，因为无需python<code>build</code></p>
</blockquote>
<h3 id="添加节点入口">添加节点入口</h3>
<p>打开 <code>setup.py</code> ，Add the following line within the
<code>console_scripts</code> brackets of the <code>entry_points</code>
field:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">entry_points=&#123;</span><br><span class="line">        &#x27;console_scripts&#x27;: [</span><br><span class="line">                &#x27;talker = py_pubsub.publisher_member_function:main&#x27;,</span><br><span class="line">        ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<blockquote>
<p>记得保存文件</p>
</blockquote>
<h3 id="检查setup.cfg">检查<code>setup.cfg</code></h3>
<p><code>setup.cfg</code>的文件内容应该会自动生成，如下文所示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[develop]</span><br><span class="line">script_dir=$base/lib/py_pubsub</span><br><span class="line">[install]</span><br><span class="line">install_scripts=$base/lib/py_pubsub</span><br></pre></td></tr></table></figure>
<p>这个仅仅是告诉构建工具<code>setuptools</code>把你的可执行文件放到install/lib目录下(该目录为ros2
run找寻可执行库的路径)。</p>
<p>接下来可以调用<code>colcon build</code>进行下载了，如果加上<code>--symlink-install</code>
参数，则修改python文件后无需重复编译，其原理是仅仅将python的软链接映射到<code>install/lib</code>目录下。</p>
<h2 id="话题相关">话题相关</h2>
<blockquote>
<p>全部采用面向对象的思想</p>
</blockquote>
<h3 id="开发流程">开发流程</h3>
<ol type="1">
<li>导入包</li>
<li>初始化工作空间</li>
<li>创建节点对象</li>
<li>调用spin方法</li>
<li>关闭节点进程</li>
</ol>
<h3 id="cpp">CPP</h3>
<h4 id="发布者">发布者</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/string.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* This example creates a subclass of Node and uses std::bind() to register a</span></span><br><span class="line"><span class="comment">* member function as a callback from the timer. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalPublisher</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MinimalPublisher</span>()</span><br><span class="line">    : <span class="built_in">Node</span>(<span class="string">&quot;minimal_publisher&quot;</span>), <span class="built_in">count_</span>(<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      publisher_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;std_msgs::msg::String&gt;(<span class="string">&quot;topic&quot;</span>, <span class="number">10</span>);</span><br><span class="line">      timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(</span><br><span class="line">      <span class="number">500</span>ms, std::<span class="built_in">bind</span>(&amp;MinimalPublisher::timer_callback, <span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">timer_callback</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">auto</span> message = std_msgs::msg::<span class="built_in">String</span>();</span><br><span class="line">      message.data = <span class="string">&quot;Hello, world! &quot;</span> + std::<span class="built_in">to_string</span>(count_++);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Publishing: &#x27;%s&#x27;&quot;</span>, message.data.<span class="built_in">c_str</span>());</span><br><span class="line">      publisher_-&gt;<span class="built_in">publish</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">    rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr publisher_;</span><br><span class="line">    <span class="type">size_t</span> count_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;MinimalPublisher&gt;());</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关键函数是</p>
<ul>
<li><code>rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr publisher_;</code></li>
<li><code>publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;("topic", 10);</code></li>
</ul>
</blockquote>
<h4 id="订阅者">订阅者</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/string.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/time.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalSubscriber</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MinimalSubscriber</span>()</span><br><span class="line">  : <span class="built_in">Node</span>(<span class="string">&quot;minimal_subscriber&quot;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    subscription_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::String&gt;(</span><br><span class="line">      <span class="string">&quot;topic&quot;</span>, <span class="number">10</span>, std::<span class="built_in">bind</span>(&amp;MinimalSubscriber::topic_callback, <span class="keyword">this</span>, _1));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">topic_callback</span><span class="params">(<span class="type">const</span> std_msgs::msg::String &amp; msg)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;I heard: &#x27;%s&#x27;&quot;</span>, msg.data.<span class="built_in">c_str</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr subscription_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;MinimalSubscriber&gt;());</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关键代码：</p>
<ul>
<li><code>rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr subscription_;</code></li>
<li>`subscription_ =
this-&gt;create_subscription<std_msgs::msg::String>(</li>
</ul>
</blockquote>
<pre><code>&gt; &quot;topic&quot;, 10, std::bind(&amp;MinimalSubscriber::topic_callback, this, _1));`</code></pre>
<h3 id="python">Python</h3>
<h4 id="发布者-1">发布者</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalPublisher</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&#x27;minimal_publisher&#x27;</span>)</span><br><span class="line">        self.publisher_ = self.create_publisher(String, <span class="string">&#x27;topic&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">        timer_period = <span class="number">0.5</span>  <span class="comment"># seconds</span></span><br><span class="line">        self.timer = self.create_timer(timer_period, self.timer_callback)</span><br><span class="line">        self.i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timer_callback</span>(<span class="params">self</span>):</span><br><span class="line">        msg = String()</span><br><span class="line">        msg.data = <span class="string">&#x27;Hello World: %d&#x27;</span> % self.i</span><br><span class="line">        self.publisher_.publish(msg)</span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;Publishing: &quot;%s&quot;&#x27;</span> % msg.data)</span><br><span class="line">        self.i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line"></span><br><span class="line">    minimal_publisher = MinimalPublisher()</span><br><span class="line"></span><br><span class="line">    rclpy.spin(minimal_publisher)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Destroy the node explicitly</span></span><br><span class="line">    <span class="comment"># (optional - otherwise it will be done automatically</span></span><br><span class="line">    <span class="comment"># when the garbage collector destroys the node object)</span></span><br><span class="line">    minimal_publisher.destroy_node()</span><br><span class="line">    rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h4 id="订阅者-1">订阅者</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalSubscriber</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&#x27;minimal_subscriber&#x27;</span>)</span><br><span class="line">        self.subscription = self.create_subscription(</span><br><span class="line">            String,</span><br><span class="line">            <span class="string">&#x27;topic&#x27;</span>,</span><br><span class="line">            self.listener_callback,</span><br><span class="line">            <span class="number">10</span>)</span><br><span class="line">        self.subscription  <span class="comment"># prevent unused variable warning</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">listener_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;I heard: &quot;%s&quot;&#x27;</span> % msg.data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line"></span><br><span class="line">    minimal_subscriber = MinimalSubscriber()</span><br><span class="line"></span><br><span class="line">    rclpy.spin(minimal_subscriber)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Destroy the node explicitly</span></span><br><span class="line">    <span class="comment"># (optional - otherwise it will be done automatically</span></span><br><span class="line">    <span class="comment"># when the garbage collector destroys the node object)</span></span><br><span class="line">    minimal_subscriber.destroy_node()</span><br><span class="line">    rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="服务相关">服务相关</h2>
<h3 id="代码编写流程">代码编写流程</h3>
<h4 id="服务端流程">服务端流程</h4>
<ol type="1">
<li>导入服务接口</li>
<li>创建服务端回调函数</li>
<li>声明并创建服务端</li>
<li>编写回调函数逻辑处理请求</li>
</ol>
<h4 id="客户端流程">客户端流程</h4>
<ol type="1">
<li>导入服务接口</li>
<li>创建请求结果接收回调函数</li>
<li>声明并创建客户端</li>
<li>编写结果接收逻辑</li>
<li>调用客户端发送请求</li>
</ol>
<h3
id="cpp这里使用了面向过程的编写方式">CPP(这里使用了面向过程的编写方式)</h3>
<h4 id="服务端">服务端</h4>
<p><strong>面向过程的写法：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Request&gt; request,</span></span></span><br><span class="line"><span class="params"><span class="function">         std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Response&gt; response)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    response-&gt;sum = request-&gt;a + request-&gt;b;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Incoming request\na: %ld&quot;</span></span><br><span class="line">                                              <span class="string">&quot; b: %ld&quot;</span>,</span><br><span class="line">                request-&gt;a, request-&gt;b);</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;sending back response: [%ld]&quot;</span>, (<span class="type">long</span> <span class="type">int</span>)response-&gt;sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化库环境</span></span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="comment">// 创建节点头(这里使用的了智能指针的方式创建)</span></span><br><span class="line">    std::shared_ptr&lt;rclcpp::Node&gt; node = rclcpp::Node::<span class="built_in">make_shared</span>(<span class="string">&quot;add_two_ints_server&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建服务器对象的指针</span></span><br><span class="line">    rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr service =</span><br><span class="line">        node-&gt;<span class="built_in">create_service</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints&quot;</span>, &amp;add);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Ready to add two ints.&quot;</span>);</span><br><span class="line">    <span class="comment">// 调度对象</span></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    <span class="comment">// 关闭节点</span></span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>面向对象的写法：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_2;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceDemoNode</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ServiceDemoNode</span>() : <span class="built_in">Node</span>(<span class="string">&quot;service_node&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;_service = <span class="keyword">this</span>-&gt;<span class="built_in">create_service</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints&quot;</span>,</span><br><span class="line">                                                                                   std::<span class="built_in">bind</span>(&amp;ServiceDemoNode::add_two_ints,</span><br><span class="line">                                                                                             <span class="keyword">this</span>, _1, _2));</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Ready to add two ints.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add_two_ints</span><span class="params">(std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Request&gt; request,</span></span></span><br><span class="line"><span class="params"><span class="function">                      std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Response&gt; response)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        response-&gt;sum = request-&gt;a + request-&gt;b;</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Incoming request\na: %ld&quot;</span></span><br><span class="line">                                        <span class="string">&quot; b: %ld&quot;</span>,</span><br><span class="line">                    request-&gt;a, request-&gt;b);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;sending back response: [%ld]&quot;</span>, (<span class="type">long</span> <span class="type">int</span>)response-&gt;sum);</span><br><span class="line">    &#125;</span><br><span class="line">    rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr _service;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;ServiceDemoNode&gt;());</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码：</p>
<ul>
<li><strong>创建服务器对象</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr service =</span><br><span class="line">node-&gt;<span class="built_in">create_service</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints&quot;</span>, &amp;add);</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><strong>定义服务响应函数</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Request&gt; request,</span></span></span><br><span class="line"><span class="params"><span class="function">std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Response&gt; response)</span></span>;</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>

</blockquote>
<h4 id="客户端">客户端</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;usage: add_two_ints_client X Y&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::shared_ptr&lt;rclcpp::Node&gt; node = rclcpp::Node::<span class="built_in">make_shared</span>(<span class="string">&quot;add_two_ints_client&quot;</span>);</span><br><span class="line">  rclcpp::Client&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr client =</span><br><span class="line">    node-&gt;<span class="built_in">create_client</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> request = std::<span class="built_in">make_shared</span>&lt;example_interfaces::srv::AddTwoInts::Request&gt;();</span><br><span class="line">  request-&gt;a = <span class="built_in">atoll</span>(argv[<span class="number">1</span>]);</span><br><span class="line">  request-&gt;b = <span class="built_in">atoll</span>(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!client-&gt;<span class="built_in">wait_for_service</span>(<span class="number">1</span>s)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!rclcpp::<span class="built_in">ok</span>()) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Interrupted while waiting for the service. Exiting.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;service not available, waiting again...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> result = client-&gt;<span class="built_in">async_send_request</span>(request);</span><br><span class="line">  <span class="comment">// Wait for the result.</span></span><br><span class="line">  <span class="keyword">if</span> (rclcpp::<span class="built_in">spin_until_future_complete</span>(node, result) ==</span><br><span class="line">    rclcpp::FutureReturnCode::SUCCESS)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Sum: %ld&quot;</span>, result.<span class="built_in">get</span>()-&gt;sum);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">RCLCPP_ERROR</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Failed to call service add_two_ints&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码：</p>
<ul>
<li><strong>创建客户端对象</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rclcpp::Client&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr client =</span><br><span class="line">node-&gt;<span class="built_in">create_client</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints&quot;</span>);</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><strong>定义请求数据结构</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> request = std::<span class="built_in">make_shared</span>&lt;example_interfaces::srv::AddTwoInts::Request&gt;();</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><p><strong>等待服务器响应</strong>：<code>client-&gt;wait_for_service(1s)</code></p></li>
<li><p><strong>发送请求并进行处理</strong></p></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> result = client-&gt;<span class="built_in">async_send_request</span>(request);</span><br><span class="line"><span class="comment">// Wait for the result.</span></span><br><span class="line"><span class="keyword">if</span> (rclcpp::<span class="built_in">spin_until_future_complete</span>(node, result) ==</span><br><span class="line">rclcpp::FutureReturnCode::SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Sum: %ld&quot;</span>, result.<span class="built_in">get</span>()-&gt;sum);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">RCLCPP_ERROR</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">&quot;rclcpp&quot;</span>), <span class="string">&quot;Failed to call service add_two_ints&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre>
<h3 id="python-1">Python</h3>
<h4 id="服务端-1">服务端</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> example_interfaces.srv <span class="keyword">import</span> AddTwoInts</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalService</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&#x27;minimal_service&#x27;</span>)</span><br><span class="line">        self.srv = self.create_service(</span><br><span class="line">            AddTwoInts, <span class="string">&#x27;add_two_ints&#x27;</span>, self.add_two_ints_callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_two_ints_callback</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        response.<span class="built_in">sum</span> = request.a + request.b</span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;Incoming request\na: %d b: %d&#x27;</span> % (request.a, request.b))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    rclpy.init()</span><br><span class="line"></span><br><span class="line">    minimal_service = MinimalService()</span><br><span class="line"></span><br><span class="line">    rclpy.spin(minimal_service)</span><br><span class="line"></span><br><span class="line">    rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码：</p>
<ul>
<li>```python self.srv = self.create_service( AddTwoInts,
'add_two_ints', self.add_two_ints_callback) <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 客户端</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">from example_interfaces.srv import AddTwoInts</span><br><span class="line">import rclpy</span><br><span class="line">from rclpy.node import Node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MinimalClientAsync(Node):</span><br><span class="line"></span><br><span class="line">   def __init__(self):</span><br><span class="line">       super().__init__(&#x27;minimal_client_async&#x27;)</span><br><span class="line">       self.cli = self.create_client(AddTwoInts, &#x27;add_two_ints&#x27;)</span><br><span class="line">       while not self.cli.wait_for_service(timeout_sec=1.0):</span><br><span class="line">           self.get_logger().info(&#x27;service not available, waiting again...&#x27;)</span><br><span class="line">       self.req = AddTwoInts.Request()</span><br><span class="line"></span><br><span class="line">   def send_request(self, a, b):</span><br><span class="line">       self.req.a = a</span><br><span class="line">       self.req.b = b</span><br><span class="line">       self.future = self.cli.call_async(self.req)</span><br><span class="line">       rclpy.spin_until_future_complete(self, self.future)</span><br><span class="line">       return self.future.result()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">   rclpy.init()</span><br><span class="line"></span><br><span class="line">   minimal_client = MinimalClientAsync()</span><br><span class="line">   response = minimal_client.send_request(int(sys.argv[1]), int(sys.argv[2]))</span><br><span class="line">   minimal_client.get_logger().info(</span><br><span class="line">       &#x27;Result of add_two_ints: for %d + %d = %d&#x27; %</span><br><span class="line">       (int(sys.argv[1]), int(sys.argv[2]), response.sum))</span><br><span class="line"></span><br><span class="line">   minimal_client.destroy_node()</span><br><span class="line">   rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">   main()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<blockquote>
<p>核心代码：</p>
<ul>
<li><strong>创建客户端对象</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;</code></pre>
<ul>
<li><code>self.cli = self.create_client(AddTwoInts, 'add_two_ints')</code></li>
</ul>
<blockquote>
<ul>
<li><strong>等待服务器响应</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;</code></pre>
<ul>
<li><code>self.cli.wait_for_service(timeout_sec=1.0)</code></li>
</ul>
<blockquote>
<ul>
<li><strong>创建响应数据结构</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;</code></pre>
<ul>
<li><code>self.req = AddTwoInts.Request()</code></li>
</ul>
<blockquote>
<ul>
<li><strong>发出服务请求</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;</code></pre>
<ul>
<li>```python</li>
</ul>
<blockquote>
<pre><code>      self.future = self.cli.call_async(self.req)`
      rclpy.spin_until_future_complete(self, self.future)`    
      self.future.result()`
      <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 自定义接口格式</span><br><span class="line"></span><br><span class="line">### 使用流程</span><br><span class="line"></span><br><span class="line">#### 在工作空间下创建interface相关的文件夹(srv,msg,action)</span><br><span class="line"></span><br><span class="line">#### [接口相关的编写方法](https://docs.ros.org/en/humble/Concepts/About-ROS-Interfaces.html)</span><br><span class="line"></span><br><span class="line">##### 不同通讯方式的接口文件形式</span><br><span class="line"></span><br><span class="line">* 话题编写*.msg</span><br><span class="line"></span><br><span class="line"> ```yaml</span><br><span class="line"> # 话题数据格式</span><br><span class="line"> string str</span><br></pre></td></tr></table></figure></code></pre>
</blockquote>
<ul>
<li><p>服务编写*.srv</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#request constants</span></span><br><span class="line"><span class="string">int8</span> <span class="string">FOO=1</span></span><br><span class="line"><span class="string">int8</span> <span class="string">BAR=2</span></span><br><span class="line"><span class="comment">#request fields</span></span><br><span class="line"><span class="string">int8</span> <span class="string">foobar</span></span><br><span class="line"><span class="string">another_pkg/AnotherMessage</span> <span class="string">msg</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#response constants</span></span><br><span class="line"><span class="string">uint32</span> <span class="string">SECRET=123456</span></span><br><span class="line"><span class="comment">#response fields</span></span><br><span class="line"><span class="string">another_pkg/YetAnotherMessage</span> <span class="string">val</span></span><br><span class="line"><span class="string">CustomMessageDefinedInThisPackage</span> <span class="string">value</span></span><br><span class="line"><span class="string">uint32</span> <span class="string">an_integer</span></span><br></pre></td></tr></table></figure></li>
<li><p><span id="action_msg">动作编写*.action</span></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#goal constants</span></span><br><span class="line"><span class="string">int8</span> <span class="string">FOO=1</span></span><br><span class="line"><span class="string">int8</span> <span class="string">BAR=2</span></span><br><span class="line"><span class="comment">#goal fields</span></span><br><span class="line"><span class="string">int8</span> <span class="string">foobar</span></span><br><span class="line"><span class="string">another_pkg/AnotherMessage</span> <span class="string">msg</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#result constants</span></span><br><span class="line"><span class="string">uint32</span> <span class="string">SECRET=123456</span></span><br><span class="line"><span class="comment">#result fields</span></span><br><span class="line"><span class="string">another_pkg/YetAnotherMessage</span> <span class="string">val</span></span><br><span class="line"><span class="string">CustomMessageDefinedInThisPackage</span> <span class="string">value</span></span><br><span class="line"><span class="string">uint32</span> <span class="string">an_integer</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#feedback constants</span></span><br><span class="line"><span class="string">uint32</span> <span class="string">SOMETHING=123456</span></span><br><span class="line"><span class="comment">#feedback fields</span></span><br><span class="line"><span class="string">uint32</span> <span class="string">process</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="类型定义">类型定义</h5>
<h6 id="内置数据类型">内置数据类型</h6>
<p><img src=".\ROS2常用代码段.assets\image-20220814091211622.png" alt="image-20220814091211622" style="zoom:50%;" /></p>
<h6 id="内置表格类型">内置表格类型</h6>
<p><img src=".\ROS2常用代码段.assets\image-20220814091328378.png" alt="image-20220814091328378" style="zoom:50%;" /></p>
<h6 id="示例">示例</h6>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">int32[]</span> <span class="string">unbounded_integer_array</span></span><br><span class="line"><span class="string">int32[5]</span> <span class="string">five_integers_array</span></span><br><span class="line"><span class="string">int32[&lt;=5]</span> <span class="string">up_to_five_integers_array</span></span><br><span class="line"></span><br><span class="line"><span class="string">string</span> <span class="string">string_of_unbounded_size</span></span><br><span class="line"><span class="string">string&lt;=10</span> <span class="string">up_to_ten_characters_string</span></span><br><span class="line"></span><br><span class="line"><span class="string">string[&lt;=5]</span> <span class="string">up_to_five_unbounded_strings</span></span><br><span class="line"><span class="string">string&lt;=10[]</span> <span class="string">unbounded_array_of_string_up_to_ten_characters_each</span></span><br><span class="line"><span class="string">string&lt;=10[&lt;=5]</span> <span class="string">up_to_five_strings_up_to_ten_characters_each</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意这里可以对数组进行约束和设置，比如固定长度，不定长度，有边界数组等，同时对于字符串也可以进行约束，参考4.1.2.2中不同数组定义下的rcl转换类型</p>
</blockquote>
<h5 id="默认值">默认值</h5>
<p><strong>格式：</strong><code>fieldtype fieldname fielddefaultvalue</code></p>
<p><strong>示例</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">uint8</span> <span class="string">x</span> <span class="number">42</span></span><br><span class="line"><span class="string">int16</span> <span class="string">y</span> <span class="number">-2000</span></span><br><span class="line"><span class="string">string</span> <span class="string">full_name</span> <span class="string">&quot;John Doe&quot;</span></span><br><span class="line"><span class="string">int32[]</span> <span class="string">samples</span> [<span class="number">-200</span>, <span class="number">-100</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>]</span><br></pre></td></tr></table></figure>
<h5 id="常数定义">常数定义</h5>
<p><strong>格式：</strong><code>constanttype CONSTANTNAME=constantvalue</code></p>
<p><strong>示例：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">int32</span> <span class="string">X=123</span></span><br><span class="line"><span class="string">int32</span> <span class="string">Y=-123</span></span><br><span class="line"><span class="string">string</span> <span class="string">FOO=&quot;foo&quot;</span></span><br><span class="line"><span class="string">string</span> <span class="string">EXAMPLE=&#x27;bar&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="编写编译文件">编写编译文件</h4>
<h5 id="核心内容">核心内容</h5>
<ol type="1">
<li><p>在package.xml中写入接口的以来包，比如<code>geometry_msgs</code>，然后写上：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>来声明要生成接口</p></li>
<li><p>在CMakeLists.txt中写上生成的接口文件：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rosidl_generate_interfaces(<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  <span class="string">&quot;msg/Num.msg&quot;</span></span><br><span class="line">  <span class="string">&quot;msg/Sphere.msg&quot;</span></span><br><span class="line">  <span class="string">&quot;srv/AddThreeInts.srv&quot;</span></span><br><span class="line">  DEPENDENCIES geometry_msgs <span class="comment"># Add packages that above messages depend on, in this case geometry_msgs for Sphere.msg</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意这里要写上相关的依赖项，特别是当使用自定义的接口来进一步封装时，更要协商当前的接口路径</p>
</blockquote></li>
</ol>
<h5 id="package.xml-3">package.xml</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-model href=<span class="string">&quot;http://download.ros.org/schema/package_format3.xsd&quot;</span> schematypens=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>tutorial_interfaces<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>TODO: Package description<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;dllr@todo.todo&quot;</span>&gt;</span>dllr<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">license</span>&gt;</span>TODO: License declaration<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake_auto<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">depend</span>&gt;</span>geometry_msgs<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="cmakelists.txt-1">CMakeLists.txt</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(tutorial_interfaces)</span><br><span class="line"></span><br><span class="line"><span class="comment"># find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_auto REQUIRED)</span><br><span class="line">ament_auto_find_build_dependencies()</span><br><span class="line"></span><br><span class="line">rosidl_generate_interfaces(<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  <span class="string">&quot;msg/Num.msg&quot;</span></span><br><span class="line">  <span class="string">&quot;msg/Sphere.msg&quot;</span></span><br><span class="line">  <span class="string">&quot;srv/AddThreeInts.srv&quot;</span></span><br><span class="line">  DEPENDENCIES geometry_msgs <span class="comment"># Add packages that above messages depend on, in this case geometry_msgs for Sphere.msg</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ament_auto_package()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意这里还导出了ament_export_dependencies(rosidl_default_runtime)，如果不使用ament_cmake_auto,记得手动加上。</p>
</blockquote>
<h4 id="使用colcon生成接口文件">使用colcon生成接口文件</h4>
<p><code>colcon build --package--selete interface_package</code></p>
<h3
id="自定义接口文件使用方法以vscode中为例">自定义接口文件使用方法(以vscode中为例)</h3>
<h4
id="在与接口定义不同功能包下的调用方法">在与接口定义不同功能包下的调用方法</h4>
<blockquote>
<p>像使用<code>geometry_msgs</code>等一样在package.xml中写入depend即可</p>
</blockquote>
<h4
id="在与接口定义相同功能包下的调用方法">在与接口定义相同功能包下的调用方法</h4>
<ol type="1">
<li><p>依据4.1中接口文件生成的流程定义接口类型</p></li>
<li><p>在CmakeLists.txt补充一下内容：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rosidl_get_typesupport_target(cpp_typesupport_target</span><br><span class="line">  <span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="string">&quot;rosidl_typesupport_cpp&quot;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(执行文件名 <span class="string">&quot;$&#123;cpp_typesupport_target&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处只需修改<strong>执行文件名</strong>即可</p>
</blockquote></li>
<li><p>像4.2.1中调用接口即可</p></li>
</ol>
<blockquote>
<p>此处建议先编译生成接口的相关文件，再进行实际功能包的编写，以方便获得代码提示和补全的功能</p>
</blockquote>
<h5 id="示例-1">示例</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmakelist.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(interface_demo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(CMAKE_COMPILER_IS_GNUCXX <span class="keyword">OR</span> CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">&quot;Clang&quot;</span>)</span><br><span class="line">  <span class="keyword">add_compile_options</span>(-Wall -Wextra -Wpedantic)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_auto REQUIRED)</span><br><span class="line">ament_auto_find_build_dependencies()</span><br><span class="line"></span><br><span class="line">rosidl_generate_interfaces(<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  <span class="string">&quot;msg/DialagDemo.msg&quot;</span></span><br><span class="line">  <span class="string">&quot;msg/TalkDemo.msg&quot;</span></span><br><span class="line">  <span class="comment"># &quot;srv/AddThreeInts.srv&quot;</span></span><br><span class="line">  DEPENDENCIES std_msgs<span class="comment"># Add packages that above messages depend on, in this case geometry_msgs for Sphere.msg</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ament_auto_add_executable(<span class="variable">$&#123;PROJECT_NAME&#125;</span>_node src/test_node.cpp)</span><br><span class="line">rosidl_get_typesupport_target(cpp_typesupport_target</span><br><span class="line">  <span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="string">&quot;rosidl_typesupport_cpp&quot;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span>_node <span class="string">&quot;$&#123;cpp_typesupport_target&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ament_auto_package()</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt; !--&gt;package.xml&lt;/!--&gt;</span><br><span class="line">        <span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line">        <span class="meta">&lt;?xml-model href=<span class="string">&quot;http://download.ros.org/schema/package_format3.xsd&quot;</span> schematypens=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>interface_demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>TODO: Package description<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">&quot;965794928@qq.com&quot;</span>&gt;</span>dllr<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">license</span>&gt;</span>TODO: License declaration<span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake_auto<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclcpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4
id="在同一功能包下使用该功能包的msg封装另一个msg">在同一功能包下使用该功能包的msg封装另一个msg</h4>
<blockquote>
<p>本质上和编写无封装的接口文件是一样的</p>
</blockquote>
<ol type="1">
<li><p>创建msg文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir msg</span><br></pre></td></tr></table></figure></li>
<li><p>使用其他功能包下的接口定义一个基础自定义接口</p>
<ul>
<li><code>msg/Demo.msg</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">uint8</span> <span class="string">hello</span></span><br><span class="line"><span class="string">bool</span> <span class="string">isopen</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用自定义接口定义以其为基础封装的接口</p>
<ul>
<li>假设当前功能包名字为<code>Demo_interface</code>,创建<code>msg/Demos.msg</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Demo_interface/Demo[3] demos_interface</span><br></pre></td></tr></table></figure></li>
<li><p>像正常编写自定义接口的方式编写<code>CmakeList.txt</code>和<code>package.xml</code>即可</p></li>
</ol>
<h4 id="vscode中代码补全的配置">vscode中代码补全的配置</h4>
<h5 id="cpp相关配置">cpp相关配置</h5>
<p>在<code>c_cpp_properties.json</code>中的<code>includePath</code>补充功能包接口库的头文件路径，如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;browse&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;databaseFilename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;default&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;limitSymbolsToIncludedHeaders&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;/opt/ros/humble/include/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;/home/dllr/my_code/ros/ws/topic_ws/src/cpp_pubsub/include/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;/usr/include/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;$&#123;workspaceFolder&#125;/install/tutorial_interfaces/include/**&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ROS&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;intelliSenseMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gcc-x64&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;compilerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/gcc&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gnu11&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cppStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++17&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处补充了<code>"$&#123;workspaceFolder&#125;/install/tutorial_interfaces/include/**"</code>，用以指明自定义接口头文件路径</p>
</blockquote>
<h5 id="python相关配置">python相关配置</h5>
<p>在<code>settings.json</code>中添加新生成python库路径，如下所示</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;python.autoComplete.extraPaths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;/opt/ros/humble/local/lib/python3.10/dist-packages&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;$&#123;workspaceFolder&#125;/install/tutorial_interfaces/local/lib/python3.10/dist-packages&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;python.analysis.extraPaths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;/opt/ros/humble/lib/python3.10/site-packages&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;/opt/ros/humble/local/lib/python3.10/dist-packages&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;$&#123;workspaceFolder&#125;/install/tutorial_interfaces/local/lib/python3.10/dist-packages&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files.associations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chrono&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;random&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处补充了<code>"$&#123;workspaceFolder&#125;/install/tutorial_interfaces/local/lib/python3.10/dist-packages"</code>，用以声明自定义接口库路径</p>
</blockquote>
<h2 id="参数相关">参数相关</h2>
<h3 id="api接口">API接口：</h3>
<p><img src=".\ROS2常用代码段.assets\image-20220814095727267.png" alt="image-20220814095727267" style="zoom:50%;" /></p>
<h3 id="cpp-1">CPP</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;rclcpp/rclcpp.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParametersClass</span>: <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ParametersClass</span>()</span><br><span class="line">      : <span class="built_in">Node</span>(<span class="string">&quot;parameter_node&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">declare_parameter</span>&lt;std::string&gt;(<span class="string">&quot;my_parameter&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">      timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(</span><br><span class="line">      <span class="number">1000</span>ms, std::<span class="built_in">bind</span>(&amp;ParametersClass::respond, <span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">respond</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_parameter</span>(<span class="string">&quot;my_parameter&quot;</span>, parameter_string_);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Hello %s&quot;</span>, parameter_string_.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::string parameter_string_;</span><br><span class="line">    rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;ParametersClass&gt;());</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码</p>
<ul>
<li><strong>声明参数：</strong><code>this-&gt;declare_parameter&lt;std::string&gt;("my_parameter", "world");</code></li>
<li><strong>获取参数：</strong><code>this-&gt;get_parameter("my_parameter", parameter_string_);</code></li>
</ul>
</blockquote>
<h3 id="python-2">Python</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">import</span> rclpy.node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalParam</span>(rclpy.node.Node):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&#x27;minimal_param_node&#x27;</span>)</span><br><span class="line">        timer_period = <span class="number">2</span>  <span class="comment"># seconds</span></span><br><span class="line">        self.timer = self.create_timer(timer_period, self.timer_callback)</span><br><span class="line">        <span class="keyword">from</span> rcl_interfaces.msg <span class="keyword">import</span> ParameterDescriptor</span><br><span class="line">        my_parameter_descriptor = ParameterDescriptor(</span><br><span class="line">            description=<span class="string">&#x27;This parameter is mine!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.declare_parameter(<span class="string">&#x27;my_parameter&#x27;</span>,</span><br><span class="line">                               <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">                               my_parameter_descriptor)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timer_callback</span>(<span class="params">self</span>):</span><br><span class="line">        my_param = self.get_parameter(</span><br><span class="line">            <span class="string">&#x27;my_parameter&#x27;</span>).get_parameter_value().string_value</span><br><span class="line"></span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;Hello %s!&#x27;</span> % my_param)</span><br><span class="line"></span><br><span class="line">        my_new_param = rclpy.parameter.Parameter(</span><br><span class="line">            <span class="string">&#x27;my_parameter&#x27;</span>,</span><br><span class="line">            rclpy.Parameter.<span class="type">Type</span>.STRING,</span><br><span class="line">            <span class="string">&#x27;world&#x27;</span></span><br><span class="line">        )</span><br><span class="line">        all_new_parameters = [my_new_param]</span><br><span class="line">        self.set_parameters(all_new_parameters)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    rclpy.init()</span><br><span class="line">    node = MinimalParam()</span><br><span class="line">    rclpy.spin(node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码：</p>
<ul>
<li>声明参数(<strong>并进行描述</strong>)</li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rcl_interfaces.msg <span class="keyword">import</span> ParameterDescriptor</span><br><span class="line">my_parameter_descriptor = ParameterDescriptor(</span><br><span class="line">description=<span class="string">&#x27;This parameter is mine!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  self.declare_parameter(<span class="string">&#x27;my_parameter&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">my_parameter_descriptor)</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><strong>获取参数</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_param = self.get_parameter(</span><br><span class="line"><span class="string">&#x27;my_parameter&#x27;</span>).get_parameter_value().string_value</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><strong>设置参数</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my_new_param = rclpy.parameter.Parameter(</span><br><span class="line"><span class="string">&#x27;my_parameter&#x27;</span>,</span><br><span class="line">rclpy.Parameter.<span class="type">Type</span>.STRING,</span><br><span class="line"><span class="string">&#x27;world&#x27;</span></span><br><span class="line">)</span><br><span class="line">all_new_parameters = [my_new_param]</span><br><span class="line">self.set_parameters(all_new_parameters)</span><br></pre></td></tr></table></figure></code></pre>
<h3 id="监测参数的变化">监测参数的变化</h3>
<blockquote>
<p>注意，在监听前，参数一定要先声明，否则是无效的！！</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SampleNodeWithParameters</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">SampleNodeWithParameters</span>()</span><br><span class="line">      : <span class="built_in">Node</span>(<span class="string">&quot;node_with_parameters&quot;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">declare_parameter</span>(<span class="string">&quot;an_int_param&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a parameter subscriber that can be used to monitor parameter changes</span></span><br><span class="line">    <span class="comment">// (for this node&#x27;s parameters as well as other nodes&#x27; parameters)</span></span><br><span class="line">    param_subscriber_ = std::<span class="built_in">make_shared</span>&lt;rclcpp::ParameterEventHandler&gt;(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set a callback for this node&#x27;s integer parameter, &quot;an_int_param&quot;</span></span><br><span class="line">    <span class="keyword">auto</span> cb = [<span class="keyword">this</span>](<span class="type">const</span> rclcpp::Parameter &amp;p)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(</span><br><span class="line">          <span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;cb: Received an update to parameter \&quot;%s\&quot; of type %s: \&quot;%ld\&quot;&quot;</span>,</span><br><span class="line">          p.<span class="built_in">get_name</span>().<span class="built_in">c_str</span>(),</span><br><span class="line">          p.<span class="built_in">get_type_name</span>().<span class="built_in">c_str</span>(),</span><br><span class="line">          p.<span class="built_in">as_int</span>());</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">auto</span> remote_node_name = std::<span class="built_in">string</span>(<span class="string">&quot;parameter_blackboard&quot;</span>);</span><br><span class="line">    <span class="keyword">auto</span> remote_param_name = std::<span class="built_in">string</span>(<span class="string">&quot;a_double_param&quot;</span>);</span><br><span class="line">    cb_handle_ = param_subscriber_-&gt;<span class="built_in">add_parameter_callback</span>(<span class="string">&quot;an_int_param&quot;</span>, cb);</span><br><span class="line">    cb_handle2_ = param_subscriber_-&gt;<span class="built_in">add_parameter_callback</span>(remote_param_name, cb, remote_node_name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::shared_ptr&lt;rclcpp::ParameterEventHandler&gt; param_subscriber_;</span><br><span class="line">  std::shared_ptr&lt;rclcpp::ParameterCallbackHandle&gt; cb_handle_;</span><br><span class="line">  std::shared_ptr&lt;rclcpp::ParameterCallbackHandle&gt; cb_handle2_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;SampleNodeWithParameters&gt;());</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码：</p>
<ul>
<li><strong>声明监听和回调对象：</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::shared_ptr&lt;rclcpp::ParameterEventHandler&gt; param_subscriber_;</span><br><span class="line">std::shared_ptr&lt;rclcpp::ParameterCallbackHandle&gt; cb_handle_;</span><br><span class="line">std::shared_ptr&lt;rclcpp::ParameterCallbackHandle&gt; cb_handle2_;</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><strong>创建监听对象：</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a parameter subscriber that can be used to monitor parameter changes</span></span><br><span class="line"><span class="comment">// (for this node&#x27;s parameters as well as other nodes&#x27; parameters)</span></span><br><span class="line">param_subscriber_ = std::<span class="built_in">make_shared</span>&lt;rclcpp::ParameterEventHandler&gt;(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><strong>创建回调函数及其对象：</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set a callback for this node&#x27;s integer parameter, &quot;an_int_param&quot;</span></span><br><span class="line"><span class="keyword">auto</span> cb = [<span class="keyword">this</span>](<span class="type">const</span> rclcpp::Parameter &amp;p)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">RCLCPP_INFO</span>(</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;cb: Received an update to parameter \&quot;%s\&quot; of type %s: \&quot;%ld\&quot;&quot;</span>,</span><br><span class="line">p.<span class="built_in">get_name</span>().<span class="built_in">c_str</span>(),</span><br><span class="line">p.<span class="built_in">get_type_name</span>().<span class="built_in">c_str</span>(),</span><br><span class="line">p.<span class="built_in">as_int</span>());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> remote_node_name = std::<span class="built_in">string</span>(<span class="string">&quot;parameter_blackboard&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> remote_param_name = std::<span class="built_in">string</span>(<span class="string">&quot;a_double_param&quot;</span>);</span><br><span class="line"><span class="comment">// 监听自己的参数变化</span></span><br><span class="line">cb_handle_ = param_subscriber_-&gt;<span class="built_in">add_parameter_callback</span>(<span class="string">&quot;an_int_param&quot;</span>, cb);</span><br><span class="line"><span class="comment">// 监听其他节点的参数变化</span></span><br><span class="line">cb_handle2_ = param_subscriber_-&gt;<span class="built_in">add_parameter_callback</span>(remote_param_name, cb, remote_node_name);</span><br></pre></td></tr></table></figure></code></pre>
<h2 id="动作相关">动作相关</h2>
<blockquote>
<ul>
<li>在写动作相关的功能包前，需要先定义好动作的<code>interface</code>
接口文件，action/xxxx.action，其格式可以参考<a
href="#action_msg">自定义接口格式处的描述</a></li>
<li>对于动作相关的完整描述，可以查看官方的<a
target="_blank" rel="noopener" href="http://design.ros2.org/articles/actions.html">设计文章</a>，有着具体的设计思路和使用方法解释</li>
</ul>
</blockquote>
<h3 id="动作的作用描述">动作的作用描述</h3>
<h4 id="服务端的作用">服务端的作用</h4>
<ul>
<li>发布的动作到ros实体</li>
<li>接受或拒绝来自于一个或多个客户端的目标请求</li>
<li>执行被接受的目标</li>
<li>选择性的提供动作执行过程的<code>feedback</code></li>
<li>选择性的处理取消等多个来自客户端的状态变化请求</li>
<li>sending the result of a completed action, including whether it
succeeded, failed, or was canceled, to a client that makes a result
request.</li>
</ul>
<h4 id="客户端的作用">客户端的作用</h4>
<ul>
<li>sending goals to the action server</li>
<li>optionally monitoring the user-defined feedback for goals from the
action server</li>
<li>optionally monitoring the current state of accepted goals from the
action server ( see <a
target="_blank" rel="noopener" href="http://design.ros2.org/articles/actions.html#goal-states">Goal
States</a>)</li>
<li>optionally requesting that the action server cancel an active
goal</li>
<li>optionally checking the result for a goal received from the action
server</li>
</ul>
<h4 id="状态过程描述">状态过程描述</h4>
<figure>
<img
src="/home/dllr/Desktop/notebook/ros2/ROS2常用代码段.assets/goal_state_machine.png"
alt="Action Goal State Machine" />
<figcaption aria-hidden="true">Action Goal State Machine</figcaption>
</figure>
<p>有三个活动状态:</p>
<ul>
<li><strong>ACCEPTED</strong> - 目标已经被接受并等待执行</li>
<li><strong>EXECUTING</strong> - 目标正在被动作服务器执行</li>
<li><strong>CANCELING</strong> -
客户端请求取消动作，并且服务端接受了取消的请求. This state is useful for
any user-defined “clean up” that the action server may have to do.</li>
</ul>
<p>此外，还有三个最终状态(客户端在result回调函数中可接受的状态):</p>
<ul>
<li><strong>SUCCEEDED</strong> - 服务端成功的完成了目标.</li>
<li><strong>ABORTED</strong> -
目标在没有外部取消请求的情况下被服务端终止了.</li>
<li><strong>CANCELED</strong> -
目标在一个客户端的取消请求后成功的终止了.</li>
</ul>
<p>状态转移发生在服务端中，其转移的触发时机由具体的代码实现决定:</p>
<ul>
<li><strong>execute</strong> - 开始执行一个目标.</li>
<li><strong>succeed</strong> - 通知说明一个动作被成功的完成了.</li>
<li><strong>abort</strong> -
通知说明在执行目标的过程中出现了某种错误，不得不终止动作的执行.</li>
<li><strong>canceled</strong> -
通知说明动作被客户端申请取消，且服务端同意申请，动作已经被取消了.</li>
</ul>
<p>在客户端可以调用下列两个函数触发动作过程的状态变化:</p>
<ul>
<li><strong>send_goal</strong> -
一个目标被送到服务端，只有当服务端接受该目标请求时，状态机才会开始工作.</li>
<li><strong>cancel_goal</strong> - 请求服务端取消目标的执行.
，只有当服务端接受了终止请求，状态才会发生转移.</li>
</ul>
<h3 id="cpp实现">CPP实现</h3>
<h4 id="动作服务器">动作服务器</h4>
<h5 id="创建功能包-2">创建功能包</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create --dependencies action_tutorials_interfaces rclcpp rclcpp_action rclcpp_components -- action_tutorials_cpp</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>此处需注意创建时的依赖，包括<code>rclcpp</code>、<code>rclcpp_action</code>,还有创建的动作<code>interface</code>功能包</li>
<li>此处的<code>rclcpp_components</code>是为了将该动作服务器注册为一个<code>component</code>组件</li>
</ul>
</blockquote>
<h5 id="编写服务端代码">编写服务端代码</h5>
<h6 id="一个动作服务器需要六个部分">一个动作服务器需要六个部分</h6>
<ol type="1">
<li>The templated action type name: <code>Fibonacci</code>.</li>
<li>A ROS 2 node to add the action to: <code>this</code>.</li>
<li>The action name: <code>'fibonacci'</code>.</li>
<li>A callback function for handling goals:
<code>handle_goal</code></li>
<li>A callback function for handling cancellation:
<code>handle_cancel</code>.</li>
<li>A callback function for handling goal accept:
<code>handle_accept</code>.</li>
</ol>
<h6 id="代码">代码</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;action_tutorials_interfaces/action/fibonacci.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_action/rclcpp_action.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_components/register_node_macro.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;action_tutorials_cpp/visibility_control.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> action_tutorials_cpp</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FibonacciActionServer</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">using</span> Fibonacci = action_tutorials_interfaces::action::Fibonacci;</span><br><span class="line">  <span class="keyword">using</span> GoalHandleFibonacci = rclcpp_action::ServerGoalHandle&lt;Fibonacci&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="function">ACTION_TUTORIALS_CPP_PUBLIC</span></span><br><span class="line"><span class="function">  <span class="keyword">explicit</span> <span class="title">FibonacciActionServer</span><span class="params">(<span class="type">const</span> rclcpp::NodeOptions &amp; options = rclcpp::NodeOptions())</span></span></span><br><span class="line"><span class="function">  : Node(<span class="string">&quot;fibonacci_action_server&quot;</span>, options)</span></span><br><span class="line"><span class="function">  &#123;</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;action_server_ = rclcpp_action::<span class="built_in">create_server</span>&lt;Fibonacci&gt;(</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      <span class="string">&quot;fibonacci&quot;</span>,</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::handle_goal, <span class="keyword">this</span>, _1, _2),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::handle_cancel, <span class="keyword">this</span>, _1),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::handle_accepted, <span class="keyword">this</span>, _1));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp_action::Server&lt;Fibonacci&gt;::SharedPtr action_server_;</span><br><span class="line"></span><br><span class="line">  <span class="function">rclcpp_action::GoalResponse <span class="title">handle_goal</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> rclcpp_action::GoalUUID &amp; uuid,</span></span></span><br><span class="line"><span class="params"><span class="function">    std::shared_ptr&lt;<span class="type">const</span> Fibonacci::Goal&gt; goal)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Received goal request with order %d&quot;</span>, goal-&gt;order);</span><br><span class="line">    (<span class="type">void</span>)uuid;</span><br><span class="line">    <span class="keyword">return</span> rclcpp_action::GoalResponse::ACCEPT_AND_EXECUTE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">rclcpp_action::CancelResponse <span class="title">handle_cancel</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::shared_ptr&lt;GoalHandleFibonacci&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Received request to cancel goal&quot;</span>);</span><br><span class="line">    (<span class="type">void</span>)goal_handle;</span><br><span class="line">    <span class="keyword">return</span> rclcpp_action::CancelResponse::ACCEPT;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">handle_accepted</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;GoalHandleFibonacci&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line">    <span class="comment">// this needs to return quickly to avoid blocking the executor, so spin up a new thread</span></span><br><span class="line">    std::thread&#123;std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::execute, <span class="keyword">this</span>, _1), goal_handle&#125;.<span class="built_in">detach</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;GoalHandleFibonacci&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Executing goal&quot;</span>);</span><br><span class="line">    <span class="function">rclcpp::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> goal = goal_handle-&gt;<span class="built_in">get_goal</span>();</span><br><span class="line">    <span class="keyword">auto</span> feedback = std::<span class="built_in">make_shared</span>&lt;Fibonacci::Feedback&gt;();</span><br><span class="line">    <span class="keyword">auto</span> &amp; sequence = feedback-&gt;partial_sequence;</span><br><span class="line">    sequence.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">    sequence.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> result = std::<span class="built_in">make_shared</span>&lt;Fibonacci::Result&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; (i &lt; goal-&gt;order) &amp;&amp; rclcpp::<span class="built_in">ok</span>(); ++i) &#123;</span><br><span class="line">      <span class="comment">// Check if there is a cancel request</span></span><br><span class="line">      <span class="keyword">if</span> (goal_handle-&gt;<span class="built_in">is_canceling</span>()) &#123;</span><br><span class="line">        result-&gt;sequence = sequence;</span><br><span class="line">        goal_handle-&gt;<span class="built_in">canceled</span>(result);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal canceled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Update sequence</span></span><br><span class="line">      sequence.<span class="built_in">push_back</span>(sequence[i] + sequence[i - <span class="number">1</span>]);</span><br><span class="line">      <span class="comment">// Publish feedback</span></span><br><span class="line">      goal_handle-&gt;<span class="built_in">publish_feedback</span>(feedback);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Publish feedback&quot;</span>);</span><br><span class="line"></span><br><span class="line">      loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if goal is done</span></span><br><span class="line">    <span class="keyword">if</span> (rclcpp::<span class="built_in">ok</span>()) &#123;</span><br><span class="line">      result-&gt;sequence = sequence;</span><br><span class="line">      goal_handle-&gt;<span class="built_in">succeed</span>(result);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal succeeded&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;  <span class="comment">// class FibonacciActionServer</span></span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace action_tutorials_cpp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">RCLCPP_COMPONENTS_REGISTER_NODE</span>(action_tutorials_cpp::FibonacciActionServer)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>关键代码：</strong></p>
<ul>
<li>创建服务器对象，此处的关键点在于需要绑定三个处理函数，分别是<code>动作启动句柄</code>，<code>动作取消句柄</code>，<code>动作完成句柄</code>
，而动作的反馈是在动作启动句柄中进行的</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;action_server_ = rclcpp_action::<span class="built_in">create_server</span>&lt;Fibonacci&gt;(</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      <span class="string">&quot;fibonacci&quot;</span>,</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::handle_goal, <span class="keyword">this</span>, _1, _2),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::handle_cancel, <span class="keyword">this</span>, _1),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionServer::handle_accepted, <span class="keyword">this</span>, _1));</span><br></pre></td></tr></table></figure>
<ul>
<li>注意代码中在动作接受句柄<code>handle_accepted</code>中调用了额外的线程执行任务的执行过程。此处是为了避免执行时间过长的阻塞，方便多个动作客户端同时工作</li>
</ul>
</blockquote>
<h4 id="动作客户端">动作客户端</h4>
<blockquote>
<p>动作客户端的功能包依赖和服务端是一样的，所以可以在同一个工作包下进行编写</p>
</blockquote>
<h5 id="编写客户端代码">编写客户端代码</h5>
<h6
id="一个动作客户端有三个重要的事情">一个动作客户端有三个重要的事情:</h6>
<ol type="1">
<li>The templated action type name: <code>Fibonacci</code>.</li>
<li>A ROS 2 node to add the action client to: <code>this</code>.</li>
<li>The action name: <code>'fibonacci'</code>.</li>
</ol>
<h6 id="代码-1">代码</h6>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;action_tutorials_interfaces/action/fibonacci.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_action/rclcpp_action.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_components/register_node_macro.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> action_tutorials_cpp</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FibonacciActionClient</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">using</span> Fibonacci = action_tutorials_interfaces::action::Fibonacci;</span><br><span class="line">  <span class="keyword">using</span> GoalHandleFibonacci = rclcpp_action::ClientGoalHandle&lt;Fibonacci&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">FibonacciActionClient</span><span class="params">(<span class="type">const</span> rclcpp::NodeOptions &amp; options)</span></span></span><br><span class="line"><span class="function">  : Node(<span class="string">&quot;fibonacci_action_client&quot;</span>, options)</span></span><br><span class="line"><span class="function">  &#123;</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;client_ptr_ = rclcpp_action::<span class="built_in">create_client</span>&lt;Fibonacci&gt;(</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      <span class="string">&quot;fibonacci&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(</span><br><span class="line">      std::chrono::<span class="built_in">milliseconds</span>(<span class="number">500</span>),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionClient::send_goal, <span class="keyword">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">send_goal</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;timer_-&gt;<span class="built_in">cancel</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;client_ptr_-&gt;<span class="built_in">wait_for_action_server</span>()) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Action server not available after waiting&quot;</span>);</span><br><span class="line">      rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> goal_msg = Fibonacci::<span class="built_in">Goal</span>();</span><br><span class="line">    goal_msg.order = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Sending goal&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> send_goal_options = rclcpp_action::Client&lt;Fibonacci&gt;::<span class="built_in">SendGoalOptions</span>();</span><br><span class="line">    send_goal_options.goal_response_callback =</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionClient::goal_response_callback, <span class="keyword">this</span>, _1);</span><br><span class="line">    send_goal_options.feedback_callback =</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionClient::feedback_callback, <span class="keyword">this</span>, _1, _2);</span><br><span class="line">    send_goal_options.result_callback =</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;FibonacciActionClient::result_callback, <span class="keyword">this</span>, _1);</span><br><span class="line">    <span class="keyword">this</span>-&gt;client_ptr_-&gt;<span class="built_in">async_send_goal</span>(goal_msg, send_goal_options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp_action::Client&lt;Fibonacci&gt;::SharedPtr client_ptr_;</span><br><span class="line">  rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">goal_response_callback</span><span class="params">(<span class="type">const</span> GoalHandleFibonacci::SharedPtr &amp; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!goal_handle) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was rejected by server&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal accepted by server, waiting for result&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">feedback_callback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    GoalHandleFibonacci::SharedPtr,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::shared_ptr&lt;<span class="type">const</span> Fibonacci::Feedback&gt; feedback)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    ss &lt;&lt; <span class="string">&quot;Next number in sequence received: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> number : feedback-&gt;partial_sequence) &#123;</span><br><span class="line">      ss &lt;&lt; number &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">result_callback</span><span class="params">(<span class="type">const</span> GoalHandleFibonacci::WrappedResult &amp; result)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (result.code) &#123;</span><br><span class="line">      <span class="keyword">case</span> rclcpp_action::ResultCode::SUCCEEDED:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> rclcpp_action::ResultCode::ABORTED:</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was aborted&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> rclcpp_action::ResultCode::CANCELED:</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was canceled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Unknown result code&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    ss &lt;&lt; <span class="string">&quot;Result received: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> number : result.result-&gt;sequence) &#123;</span><br><span class="line">      ss &lt;&lt; number &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;  <span class="comment">// class FibonacciActionClient</span></span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace action_tutorials_cpp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">RCLCPP_COMPONENTS_REGISTER_NODE</span>(action_tutorials_cpp::FibonacciActionClient)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>关键代码：</strong></p>
<ul>
<li>创建客户端对象，传入其<code>动作接口类型</code>、<code>所属节点</code>、<code>动作名称</code>:</li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;client_ptr_ = rclcpp_action::<span class="built_in">create_client</span>&lt;Fibonacci&gt;(</span><br><span class="line"><span class="keyword">this</span>,</span><br><span class="line"><span class="string">&quot;fibonacci&quot;</span>);</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li>发送目标<code>send_goal()</code>:</li>
</ul>
</blockquote>
<pre><code>&gt;</code></pre>
<ul>
<li>创建目标消息：<code>auto goal_msg = Fibonacci::Goal()</code></li>
</ul>
<blockquote>
<ul>
<li>如果要监测动作过程的<code>feedback</code>、<code>result</code>
等，需要配置<code>auto send_goal_options = rclcpp_action::Client&lt;Fibonacci&gt;::SendGoalOptions();</code>
<ul>
<li>发送目标，建议使用异步发送<code>this-&gt;client_ptr_-&gt;async_send_goal(goal_msg, send_goal_options);</code></li>
</ul></li>
</ul>
<blockquote>
<p>注意自定义的监测函数的参数定义和类型</p>
<ul>
<li><code>goal_response_callback</code>：监测目标发送是否被接受</li>
</ul>
</blockquote>
</blockquote>
<pre><code>  &gt; &gt;
  &gt; &gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">goal_response_callback</span><span class="params">(<span class="type">const</span> GoalHandleFibonacci::SharedPtr &amp; goal_handle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!goal_handle) &#123;</span><br><span class="line"><span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was rejected by server&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal accepted by server, waiting for result&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<blockquote>
<ul>
<li><code>feedback_callback</code>:监测动作的反馈过程，在导航和连续作业中很重要</li>
</ul>
</blockquote>
</blockquote>
<pre><code>  &gt; &gt;
  &gt; &gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">feedback_callback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">GoalHandleFibonacci::SharedPtr,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">const</span> std::shared_ptr&lt;<span class="type">const</span> Fibonacci::Feedback&gt; feedback)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::stringstream ss;</span><br><span class="line">ss &lt;&lt; <span class="string">&quot;Next number in sequence received: &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> number : feedback-&gt;partial_sequence) &#123;</span><br><span class="line">ss &lt;&lt; number &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<blockquote>
<ul>
<li><code>result_callback</code>:查看当前动作的完成情况，其中</li>
</ul>
</blockquote>
</blockquote>
<pre><code>  &gt; &gt;
  &gt; &gt;</code></pre>
<ul>
<li><code>rclcpp_action::ResultCode::ABORTED</code>：表示目标被中止了，通常是非用户取消而服务端异常等情况下反馈的最终执行状态</li>
</ul>
<blockquote>
<blockquote>
<ul>
<li><code>rclcpp_action::ResultCode::CANCELED</code>：表示目标被客户端取消了，通常是用户手动取消目标是反馈的最终执行状态
<ul>
<li><code>rclcpp_action::ResultCode::SUCCEEDED</code>：表示目标成功执行，并返回最终结果</li>
</ul></li>
</ul>
</blockquote>
</blockquote>
<pre><code>    &gt; &gt;
    &gt; &gt;   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">result_callback</span><span class="params">(<span class="type">const</span> GoalHandleFibonacci::WrappedResult &amp; result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">switch</span> (result.code) &#123;</span><br><span class="line"><span class="keyword">case</span> rclcpp_action::ResultCode::SUCCEEDED:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> rclcpp_action::ResultCode::ABORTED:</span><br><span class="line"><span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was aborted&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">case</span> rclcpp_action::ResultCode::CANCELED:</span><br><span class="line"><span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was canceled&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Unknown result code&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">std::stringstream ss;</span><br><span class="line">ss &lt;&lt; <span class="string">&quot;Result received: &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> number : result.result-&gt;sequence) &#123;</span><br><span class="line">ss &lt;&lt; number &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;; <span class="comment">// class FibonacciActionClient</span></span><br></pre></td></tr></table></figure></code></pre>
<h3 id="python实现">Python实现</h3>
<h4 id="动作服务器-1">动作服务器</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.action <span class="keyword">import</span> ActionServer</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> action_tutorials_interfaces.action <span class="keyword">import</span> Fibonacci</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FibonacciActionServer</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&#x27;fibonacci_action_server&#x27;</span>)</span><br><span class="line">        self._action_server = ActionServer(</span><br><span class="line">            self,</span><br><span class="line">            Fibonacci,</span><br><span class="line">            <span class="string">&#x27;fibonacci&#x27;</span>,</span><br><span class="line">            self.execute_callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_callback</span>(<span class="params">self, goal_handle</span>):</span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;Executing goal...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        feedback_msg = Fibonacci.Feedback()</span><br><span class="line"></span><br><span class="line">        feedback_msg.partial_sequence = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, goal_handle.request.order):</span><br><span class="line">            feedback_msg.partial_sequence.append(</span><br><span class="line"></span><br><span class="line">                feedback_msg.partial_sequence[i] + feedback_msg.partial_sequence[i - <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">            self.get_logger().info(<span class="string">&#x27;Feedback: &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(feedback_msg.partial_sequence))</span><br><span class="line"></span><br><span class="line">            goal_handle.publish_feedback(feedback_msg)</span><br><span class="line"></span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        goal_handle.succeed()</span><br><span class="line"></span><br><span class="line">        result = Fibonacci.Result()</span><br><span class="line"></span><br><span class="line">        result.sequence = feedback_msg.partial_sequence</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line"></span><br><span class="line">    fibonacci_action_server = FibonacciActionServer()</span><br><span class="line"></span><br><span class="line">    rclpy.spin(fibonacci_action_server)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>关键代码：</strong></p>
<ul>
<li>创建服务服务器对象，此处仅仅给出了执行过程的回调函数，但和cpp一样，在python中也可以给出接受目标的回调函数以及拒绝目标的回调函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self._action_server = ActionServer(</span><br><span class="line">    self,</span><br><span class="line">    Fibonacci,</span><br><span class="line">    <span class="string">&#x27;fibonacci&#x27;</span>,</span><br><span class="line">    self.execute_callback)</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="动作客户端-1">动作客户端</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.action <span class="keyword">import</span> ActionClient</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> action_tutorials_interfaces.action <span class="keyword">import</span> Fibonacci</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FibonacciActionClient</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&#x27;fibonacci_action_client&#x27;</span>)</span><br><span class="line">        self._action_client = ActionClient(self, Fibonacci, <span class="string">&#x27;fibonacci&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_goal</span>(<span class="params">self, order</span>):</span><br><span class="line">        goal_msg = Fibonacci.Goal()</span><br><span class="line">        goal_msg.order = order</span><br><span class="line"></span><br><span class="line">        self._action_client.wait_for_server()</span><br><span class="line"></span><br><span class="line">        self._send_goal_future = self._action_client.send_goal_async(goal_msg)</span><br><span class="line"></span><br><span class="line">        self._send_goal_future.add_done_callback(self.goal_response_callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">goal_response_callback</span>(<span class="params">self, future</span>):</span><br><span class="line">        goal_handle = future.result()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> goal_handle.accepted:</span><br><span class="line">            self.get_logger().info(<span class="string">&#x27;Goal rejected :(&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;Goal accepted :)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self._get_result_future = goal_handle.get_result_async()</span><br><span class="line">        self._get_result_future.add_done_callback(self.get_result_callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_result_callback</span>(<span class="params">self, future</span>):</span><br><span class="line">        result = future.result().result</span><br><span class="line">        self.get_logger().info(<span class="string">&#x27;Result: &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(result.sequence))</span><br><span class="line">        rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line"></span><br><span class="line">    action_client = FibonacciActionClient()</span><br><span class="line"></span><br><span class="line">    action_client.send_goal(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    rclpy.spin(action_client)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>关键代码：</strong></p>
<ul>
<li><p>创建客户端对象：<code>self._action_client = ActionClient(self, Fibonacci, 'fibonacci')</code></p></li>
<li><p>发送目标时等待<code>response</code>，此处注意，在调用<code>send_goal_async</code>时可以传入<code>feedback_callback</code>函数</p></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self._send_goal_future = self._action_client.send_goal_async(goal_msg)</span><br><span class="line"></span><br><span class="line">  self._send_goal_future.add_done_callback(self.goal_response_callback)</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li>当获得响应时调用</li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self._get_result_future = goal_handle.get_result_async()</span><br><span class="line">self._get_result_future.add_done_callback(self.get_result_callback)</span><br></pre></td></tr></table></figure></code></pre>
<h2 id="pluginlib的编写方法">pluginlib的编写方法</h2>
<blockquote>
<p>ros中的pluginlib实现的本质是cpp中的对象<strong>多态</strong>，通过调用基类对象指针，控制不同的继承类的函数接口</p>
</blockquote>
<h3 id="安装pluginlib">安装<code>pluginlib</code></h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-&#123;$ROS_DISTRO&#125;-pluginlib</span><br></pre></td></tr></table></figure>
<h3 id="使用流程">使用流程</h3>
<h4 id="编写基类库文件">编写基类库文件</h4>
<h5 id="创建工作包">创建工作包</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create --build-type ament_cmake polygon_base --dependencies pluginlib --node-name area_node</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处的关键是添加pluginlib依赖</p>
</blockquote>
<h5 id="创建基类库头文件并编写">创建基类库头文件并编写</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> POLYGON_BASE_REGULAR_POLYGON_HPP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> POLYGON_BASE_REGULAR_POLYGON_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> polygon_base</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">RegularPolygon</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">      <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">initialize</span><span class="params">(<span class="type">double</span> side_length)</span> </span>= <span class="number">0</span>;</span><br><span class="line">      <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">virtual</span> ~<span class="built_in">RegularPolygon</span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">      <span class="built_in">RegularPolygon</span>()&#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;  <span class="comment">// namespace polygon_base</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">// POLYGON_BASE_REGULAR_POLYGON_HPP</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>关键代码：</p>
<p>构建虚构函数和纯虚函数，和<code>CPP</code>的多态一样</p>
</blockquote>
<h5 id="编写cmakelist.txt">编写CmakeList.txt</h5>
<blockquote>
<p>安装和导出头文件</p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 安装头文件</span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  DIRECTORY <span class="keyword">include</span>/</span><br><span class="line">  DESTINATION <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 导出头文件，方便后续依赖包找寻</span><br><span class="line">ament_export_include_directories(</span><br><span class="line">  <span class="keyword">include</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="colcon-build进行基类库文件安装">colcon
build进行基类库文件安装</h5>
<h4 id="编写插件库文件继承类">编写插件库文件(继承类)</h4>
<h5 id="创建工作包-1">创建工作包</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create --build-type ament_cmake polygon_plugins --dependencies polygon_base pluginlib --library-name polygon_plugins</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处不仅要加入<code>pluginlib</code>的依赖，还要加入刚刚创建的基类库工作包作为依赖</p>
</blockquote>
<h5 id="编写插件库文件的代码">编写插件库文件的代码</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;polygon_base/regular_polygon.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> polygon_plugins</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Square</span> : <span class="keyword">public</span> polygon_base::RegularPolygon</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">      <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">(<span class="type">double</span> side_length)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        side_length_ = side_length;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> side_length_ * side_length_;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">      <span class="type">double</span> side_length_;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Triangle</span> : <span class="keyword">public</span> polygon_base::RegularPolygon</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">      <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">(<span class="type">double</span> side_length)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        side_length_ = side_length;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.5</span> * side_length_ * <span class="built_in">getHeight</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="type">double</span> <span class="title">getHeight</span><span class="params">()</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sqrt</span>((side_length_ * side_length_) - ((side_length_ / <span class="number">2</span>) * (side_length_ / <span class="number">2</span>)));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">      <span class="type">double</span> side_length_;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pluginlib/class_list_macros.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PLUGINLIB_EXPORT_CLASS</span>(polygon_plugins::Square, polygon_base::RegularPolygon)</span><br><span class="line"><span class="built_in">PLUGINLIB_EXPORT_CLASS</span>(polygon_plugins::Triangle, polygon_base::RegularPolygon)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关键代码：</p>
<ul>
<li>继承基类<code>class Square : public polygon_base::RegularPolygon</code></li>
<li>编写继承的函数代码<code>initialize</code>、<code>area</code>，注意此处每个类内部可以有自己的函数接口</li>
<li>加载到pluginlib当中：</li>
</ul>
</blockquote>
<pre><code>&gt;</code></pre>
<ul>
<li>包含头文件<code>#include&lt;pluginlib/class_list_macros.hpp&gt;</code></li>
</ul>
<blockquote>
<ul>
<li>导出继承类<code>PLUGINLIB_EXPORT_CLASS(polygon_plugins::Square, polygon_base::RegularPolygon)</code></li>
</ul>
</blockquote>
<h5 id="编写插件声明xml">编写插件声明XML</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">library</span> <span class="attr">path</span>=<span class="string">&quot;polygon_plugins&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">type</span>=<span class="string">&quot;polygon_plugins::Square&quot;</span> <span class="attr">base_class_type</span>=<span class="string">&quot;polygon_base::RegularPolygon&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>This is a square plugin.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">type</span>=<span class="string">&quot;polygon_plugins::Triangle&quot;</span> <span class="attr">base_class_type</span>=<span class="string">&quot;polygon_base::RegularPolygon&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>This is a triangle plugin.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">library</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ol type="1">
<li><code>library</code>标签给出了包含我们希望导出的插件的相关路径。在ROS2中，这就是插件库的名字，而在ROS1中他需要包含<code>lib</code>前缀。</li>
<li><code>class</code>标签声明了我们插件库中希望导出的插件，下面说明了<code>class</code>中的一些配置参数</li>
</ol>
<blockquote>
<ul>
<li><code>type</code>: The fully qualified type of the plugin. For us,
that’s <code>polygon_plugins::Square</code>.</li>
<li><code>base_class</code>: The fully qualified base class type for the
plugin. For us, that’s <code>polygon_base::RegularPolygon</code>.</li>
<li><code>description</code>: A description of the plugin and what it
does.</li>
</ul>
</blockquote>
</blockquote>
<h5 id="配置cmakelist.txt">配置CmakeList.txt</h5>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(polygon_plugins)</span><br><span class="line"></span><br><span class="line"><span class="comment"># find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_ros REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(polygon_base REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(pluginlib REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(polygon_plugins src/polygon_plugins.cpp)</span><br><span class="line"><span class="keyword">target_compile_features</span>(polygon_plugins PUBLIC c_std_99 cxx_std_17)  <span class="comment"># Require C99 and C++17</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(polygon_plugins PUBLIC</span><br><span class="line">  $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">  $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  polygon_plugins</span><br><span class="line">  <span class="string">&quot;polygon_base&quot;</span></span><br><span class="line">  <span class="string">&quot;pluginlib&quot;</span></span><br><span class="line">)</span><br><span class="line">pluginlib_export_plugin_description_file(polygon_base plugins.xml)</span><br><span class="line"><span class="comment"># Causes the visibility macros to use dllexport rather than dllimport,</span></span><br><span class="line"><span class="comment"># which is appropriate when building the dll but not consuming it.</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(polygon_plugins PRIVATE <span class="string">&quot;POLYGON_PLUGINS_BUILDING_LIBRARY&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  DIRECTORY <span class="keyword">include</span>/</span><br><span class="line">  DESTINATION <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  TARGETS polygon_plugins</span><br><span class="line">  <span class="keyword">EXPORT</span> export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(BUILD_TESTING)</span><br><span class="line">  <span class="keyword">find_package</span>(ament_lint_auto REQUIRED)</span><br><span class="line">  <span class="comment"># the following line skips the linter which checks for copyrights</span></span><br><span class="line">  <span class="comment"># comment the line when a copyright and license is added to all source files</span></span><br><span class="line">  <span class="keyword">set</span>(ament_cmake_copyright_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line">  <span class="comment"># the following line skips cpplint (only works in a git repo)</span></span><br><span class="line">  <span class="comment"># comment the line when this package is in a git repo and when</span></span><br><span class="line">  <span class="comment"># a copyright and license is added to all source files</span></span><br><span class="line">  <span class="keyword">set</span>(ament_cmake_cpplint_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line">  ament_lint_auto_find_test_dependencies()</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line">ament_export_include_directories(</span><br><span class="line">  <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line">ament_export_libraries(</span><br><span class="line">  polygon_plugins</span><br><span class="line">)</span><br><span class="line">ament_export_targets(</span><br><span class="line">  export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ament_package()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>关键代码</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加库及其依赖</span></span><br><span class="line"><span class="keyword">add_library</span>(polygon_plugins src/polygon_plugins.cpp)</span><br><span class="line"><span class="keyword">target_include_directories</span>(polygon_plugins PUBLIC</span><br><span class="line">  $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">  $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  polygon_plugins</span><br><span class="line">  polygon_base</span><br><span class="line">  pluginlib</span><br><span class="line">)</span><br><span class="line"><span class="comment"># **此处是插件安装最为重要的指令，导出配置文件</span></span><br><span class="line">pluginlib_export_plugin_description_file(polygon_base plugins.xml)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将插件生成的库进行下载</span></span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  TARGETS polygon_plugins</span><br><span class="line">  <span class="keyword">EXPORT</span> export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>在 <code>ament_package</code> 指令前, 添加</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ament_export_libraries(</span><br><span class="line">  polygon_plugins</span><br><span class="line">)</span><br><span class="line">ament_export_targets(</span><br><span class="line">  export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="colcon-build进行插件类库文件安装">colcon
build进行插件类库文件安装</h5>
<h4 id="使用插件">使用插件</h4>
<blockquote>
<p>在使用插件时，该库无需导入插件库的依赖，只需导入基类的依赖和<code>pluginlib</code>的依赖即可</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pluginlib/class_loader.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;polygon_base/regular_polygon.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// To avoid unused parameter warnings</span></span><br><span class="line">  (<span class="type">void</span>) argc;</span><br><span class="line">  (<span class="type">void</span>) argv;</span><br><span class="line"></span><br><span class="line">  <span class="function">pluginlib::ClassLoader&lt;polygon_base::RegularPolygon&gt; <span class="title">poly_loader</span><span class="params">(<span class="string">&quot;polygon_base&quot;</span>, <span class="string">&quot;polygon_base::RegularPolygon&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    std::shared_ptr&lt;polygon_base::RegularPolygon&gt; triangle = poly_loader.<span class="built_in">createSharedInstance</span>(<span class="string">&quot;polygon_plugins::Triangle&quot;</span>);</span><br><span class="line">    triangle-&gt;<span class="built_in">initialize</span>(<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">    std::shared_ptr&lt;polygon_base::RegularPolygon&gt; square = poly_loader.<span class="built_in">createSharedInstance</span>(<span class="string">&quot;polygon_plugins::Square&quot;</span>);</span><br><span class="line">    square-&gt;<span class="built_in">initialize</span>(<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Triangle area: %.2f\n&quot;</span>, triangle-&gt;<span class="built_in">area</span>());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Square area: %.2f\n&quot;</span>, square-&gt;<span class="built_in">area</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">catch</span>(pluginlib::PluginlibException&amp; ex)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The plugin failed to load for some reason. Error: %s\n&quot;</span>, ex.<span class="built_in">what</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>关键代码：</strong></p>
<ul>
<li><code>ClassLoader</code>是关键类，该类定义在<code>class_loader.hpp</code>中，该类实现了一下功能：</li>
</ul>
</blockquote>
<pre><code>&gt;</code></pre>
<ul>
<li>他将基类作为模板, 比如<code>polygon_base::RegularPolygon</code></li>
</ul>
<blockquote>
<ul>
<li>第一个参数是基类的<strong>库</strong>名字,
比如<code>polygon_base</code>
<ul>
<li>第二个参数是完整的基类类型(包含cpp命名空间) ，比如
<code>polygon_base::RegularPolygon</code></li>
</ul></li>
<li>使用<code>createSharedInstance</code>创建共享实例</li>
</ul>
</blockquote>
<h5 id="colcon-build进行可执行节点的编译安装">colcon
build进行可执行节点的编译安装</h5>
<h5 id="运行节点">运行节点</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run polygon_base area_node</span><br></pre></td></tr></table></figure>
<h2 id="launch文件的编写方法">launch文件的编写方法</h2>
<h3 id="目录结构及功能包内下载方法">目录结构及功能包内下载方法</h3>
<h4 id="ament_python结构">ament_python结构</h4>
<h5 id="项目结构">项目结构</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">    my_package/</span><br><span class="line">        launch/</span><br><span class="line">        setup.py</span><br><span class="line">        setup.cfg</span><br><span class="line">        package.xml</span><br></pre></td></tr></table></figure>
<h5 id="下载方法">下载方法</h5>
<blockquote>
<p>在setup.py中进行声明</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"></span><br><span class="line">package_name = <span class="string">&#x27;my_package&#x27;</span></span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    <span class="comment"># Other parameters ...</span></span><br><span class="line">    data_files=[</span><br><span class="line">        <span class="comment"># ... Other data files</span></span><br><span class="line">        <span class="comment"># Include all launch files. This is the most important line here!</span></span><br><span class="line">        (os.path.join(<span class="string">&#x27;share&#x27;</span>, package_name), glob(<span class="string">&#x27;launch/*launch.[pxy][yma]*&#x27;</span>))</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="ament_cmake结构">ament_cmake结构</h4>
<h5 id="项目结构-1">项目结构</h5>
<h5 id="下载方法-1">下载方法</h5>
<blockquote>
<p>在CMakeLists.txt中进行下载</p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install launch files.</span></span><br><span class="line"><span class="keyword">install</span>(DIRECTORY</span><br><span class="line">  launch</span><br><span class="line">  DESTINATION share/<span class="variable">$&#123;PROJECT_NAME&#125;</span>/</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="使用python进行编写">使用python进行编写</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([</span><br><span class="line">        Node(</span><br><span class="line">            package=<span class="string">&#x27;turtlesim&#x27;</span>,</span><br><span class="line">            namespace=<span class="string">&#x27;turtlesim1&#x27;</span>,</span><br><span class="line">            executable=<span class="string">&#x27;turtlesim_node&#x27;</span>,</span><br><span class="line">            name=<span class="string">&#x27;sim&#x27;</span></span><br><span class="line">        ),</span><br><span class="line">        Node(</span><br><span class="line">            package=<span class="string">&#x27;turtlesim&#x27;</span>,</span><br><span class="line">            namespace=<span class="string">&#x27;turtlesim2&#x27;</span>,</span><br><span class="line">            executable=<span class="string">&#x27;turtlesim_node&#x27;</span>,</span><br><span class="line">            name=<span class="string">&#x27;sim&#x27;</span></span><br><span class="line">        ),</span><br><span class="line">        Node(</span><br><span class="line">            package=<span class="string">&#x27;turtlesim&#x27;</span>,</span><br><span class="line">            executable=<span class="string">&#x27;mimic&#x27;</span>,</span><br><span class="line">            name=<span class="string">&#x27;mimic&#x27;</span>,</span><br><span class="line">            remappings=[</span><br><span class="line">                (<span class="string">&#x27;/input/pose&#x27;</span>, <span class="string">&#x27;/turtlesim1/turtle1/pose&#x27;</span>),</span><br><span class="line">                (<span class="string">&#x27;/output/cmd_vel&#x27;</span>, <span class="string">&#x27;/turtlesim2/turtle1/cmd_vel&#x27;</span>),</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line">    ])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心代码：</p>
<ul>
<li><strong>导入包：</strong></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>
<ul>
<li><p><strong>创建<code>generate_launch_description()</code>函数</strong></p></li>
<li><p><strong>编写<code>LaunchDescription</code></strong></p></li>
</ul>
</blockquote>
<pre><code>&gt;
&gt;</code></pre>
<ul>
<li>写入<code>Node</code><strong>节点对象</strong> &gt; &gt;
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Node(</span><br><span class="line">    package=<span class="string">&#x27;turtlesim&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;mimic&#x27;</span>,</span><br><span class="line">            name=<span class="string">&#x27;mimic&#x27;</span>,</span><br><span class="line">            remappings=[</span><br><span class="line">              		(<span class="string">&#x27;/input/pose&#x27;</span>, <span class="string">&#x27;/turtlesim1/turtle1/pose&#x27;</span>),</span><br><span class="line">                	(<span class="string">&#x27;/output/cmd_vel&#x27;</span>, <span class="string">&#x27;/turtlesim2/turtle1/cmd_vel&#x27;</span>),</span><br><span class="line">            	]</span><br><span class="line">     )</span><br></pre></td></tr></table></figure></li>
</ul>
<h4
id="导入substitutions实现launch文件的参数配置">导入<code>substitutions</code>实现<code>launch</code>文件的参数配置</h4>
<h5 id="使用场景">使用场景</h5>
<blockquote>
<p>启动文件用于启动节点、服务和执行进程。这组操作可能有参数，这些参数会影响它们的行为。在描述可重用启动文件时，可以在参数中使用<code>substitutions</code>
，以提供更大的灵活性。<code>substitutions</code>是仅在启动描述执行期间计算的变量，可用于获取特定信息，如启动配置、环境变量或计算任意Python表达式</p>
</blockquote>
<h3
id="使用过程中的一些tip和注意事项">使用过程中的一些tip和注意事项</h3>
<h4 id="调用方法">调用方法</h4>
<ol type="1">
<li><p>可以在launch目录下直接调用xxx.py文件(注意要激活环境变量)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd launch</span><br><span class="line">ros2 launch turtlesim_mimic_launch.py</span><br></pre></td></tr></table></figure></li>
<li><p>也可以将其在功能包下下载到install文件夹下，如何使用如下形式调用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 launch &lt;package_name&gt; &lt;launch_file_name&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="建议在package.xml中写入依赖">建议在package.xml中写入依赖</h4>
<p><img src="https://dl-poke.oss-cn-beijing.aliyuncs.com/pokeimage-20220815100951291.png" alt="image-20220815100951291" style="zoom:50%;" /></p>
<h2 id="executor相关">Executor相关</h2>
<h3 id="定义">定义</h3>
<p><code>excecute</code>是ros2中显式管理通许回调等事务的对象，一个<code>execute</code>通常会使用对应操作系统的一个或多个线程去处理<strong>话题</strong>、<strong>定时器
</strong>、<strong>服务</strong>、<strong>动作</strong>服务器等通讯过程的回调函数。</p>
<figure>
<img
src="https://dl-poke.oss-cn-beijing.aliyuncs.com/pokeexecutors_basic_principle.png"
alt="./ROS2常用代码段.assets/executors_basic_principle.png" />
<figcaption
aria-hidden="true">./ROS2常用代码段.assets/executors_basic_principle.png</figcaption>
</figure>
<h3 id="types-of-executors">Types of Executors</h3>
<figure>
<img
src="https://dl-poke.oss-cn-beijing.aliyuncs.com/pokegraphviz-c1160194dae16051e00be2abef23d0fce5e7c347.png"
alt="digraph Flatland" />
<figcaption aria-hidden="true">digraph Flatland</figcaption>
</figure>
<p>目前ros2提供了三种<code>executor</code>，分别为：</p>
<ol type="1">
<li><p><code>Single-Threaded Executor</code>：这是ros2<code>spin</code>方法默认的<code>exceutor</code>。</p>
<ul>
<li>可以动态的创建回调对象</li>
<li>互斥(串行)的执行各个回调函数</li>
</ul>
<blockquote>
<p>ros2中的<a
target="_blank" rel="noopener" href="https://docs.ros.org/en/foxy/Concepts/About-Composition.html">components</a>使用的也是这种<code>executor</code></p>
</blockquote></li>
<li><p><code>Multi-Threaded Executor</code>：创建一系列可配置的线程从而允许同时处理多个消息和事件</p>
<ul>
<li>可以动态的创建回调对象</li>
<li>当调用配置为<code>Reentrant</code>的<code>Callback groups</code>时可以并行的处理的处理消息和事件</li>
</ul></li>
<li><p><code>Static Single-Threaded Executor</code></p>
<ul>
<li>其与<code>Single-Threaded Executor</code>最大的不同是仅可以在初始化的时候添加<strong>话题</strong>、<strong>定时器</strong>、<strong>服务</strong>、<strong>动作</strong>
服务器等通讯过程的回调函数。</li>
</ul>
<blockquote>
<p>其他两个方法会不断扫描现有的所有回调对象，而该<code>excutor</code>仅会在初始化时扫描一次，所以实际上可以添加新对象，只是没啥用而已</p>
</blockquote></li>
</ol>
<p>示例代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rclcpp::Node::SharedPtr node1 = ...</span><br><span class="line">rclcpp::Node::SharedPtr node2 = ...</span><br><span class="line">rclcpp::Node::SharedPtr node3 = ...</span><br><span class="line"></span><br><span class="line">rclcpp::executors::StaticSingleThreadedExecutor executor;</span><br><span class="line">executor.<span class="built_in">add_node</span>(node1);</span><br><span class="line">executor.<span class="built_in">add_node</span>(node2);</span><br><span class="line">executor.<span class="built_in">add_node</span>(node2);</span><br><span class="line">executor.<span class="built_in">spin</span>();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处说明一个<code>executor</code>
可以同时服务多个节点，但这些节点是串行处理的，若想实现真正的并行化处理，需要使用创建<code>Multi-Threaded Executor</code>
，并调用<code>callback groups</code></p>
</blockquote>
<h3 id="callback-groups">Callback groups</h3>
<h4 id="种类">种类</h4>
<ul>
<li><code>Mutually exclusive</code>:Callbacks of this group must not be
executed in parallel.</li>
<li><code>Reentrant</code>: Callbacks of this group may be executed in
parallel.</li>
</ul>
<blockquote>
<p>ros2默认使用使用<code>Mutually exclusive</code>，我们可以可以通过cpp调用<code>NodeBaseInterface::get_default_callback_group()</code>
或python调用<code>Node.default_callback_group</code>查看默认的<code>Callback groups</code></p>
</blockquote>
<h4 id="使用方法">使用方法</h4>
<h5 id="c">c++</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my_callback_group = <span class="built_in">create_callback_group</span>(rclcpp::CallbackGroupType::MutuallyExclusive);</span><br><span class="line"></span><br><span class="line">rclcpp::SubscriptionOptions options;</span><br><span class="line">options.callback_group = my_callback_group;</span><br><span class="line"></span><br><span class="line">my_subscription = <span class="built_in">create_subscription</span>&lt;Int32&gt;(<span class="string">&quot;/topic&quot;</span>, rclcpp::<span class="built_in">SensorDataQoS</span>(),</span><br><span class="line">                                             callback, options);</span><br></pre></td></tr></table></figure>
<h5 id="python-3">python</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_callback_group = MutuallyExclusiveCallbackGroup()</span><br><span class="line">my_subscription = self.create_subscription(Int32, <span class="string">&quot;/topic&quot;</span>, self.callback, qos_profile=<span class="number">1</span>,</span><br><span class="line">                                           callback_group=my_callback_group)</span><br></pre></td></tr></table></figure>
<h4 id="额外说明">额外说明</h4>
<blockquote>
<p>简而言之就是可以调用<code>executor</code>的<code>add_callback_group</code>方法，实现一个节点的回调多次并行调用，且可以通过操作系统的线程配置优先级</p>
</blockquote>
<p>Since Galactic, the interface of the Executor base class in rclcpp
has been refined by a new function <code>add_callback_group(..)</code>.
This allows distributing callback groups to different Executors. By
configuring the underlying threads using the operating system scheduler,
specific callbacks can be prioritized over other callbacks. For example,
the subscriptions and timers of a control loop can be prioritized over
all other subscriptions and standard services of a node. The <a
target="_blank" rel="noopener" href="https://github.com/ros2/examples/tree/foxy/rclcpp/executors/cbg_executor">examples_rclcpp_cbg_executor
package</a> provides a demo of this mechanism.</p>
<h3 id="默认处理顺序">默认处理顺序</h3>
<figure>
<img
src="https://dl-poke.oss-cn-beijing.aliyuncs.com/pokeexecutors_scheduling_semantics.png"
alt="../_images/executors_scheduling_semantics.png" />
<figcaption
aria-hidden="true">../_images/executors_scheduling_semantics.png</figcaption>
</figure>
<ul>
<li>如果回调的处理时间小于设定的周期，则使用队列进行事件调度</li>
<li>如果回调的时间大于设定的周期，则使用压栈的方式进行调度</li>
</ul>
<h3 id="与ros1的区别与联系">与ROS1的区别与联系</h3>
<ol type="1">
<li>在ros1中我们使用<code>spin</code>函数进行调度管理，而ros2中的<code>executor</code>提供了更多可控的执行机制，但其基本API与ros1十分相似</li>
<li>在ros2中，<code>executor</code>负责创建线程与<code>rcl</code>以及<code>middleware layers</code>进行轮询处理。为了保证不与通讯中间件的<code>Qos</code>
设置发生冲突，<code>executor</code>不会将到来的消息存储在<code>Client Library layer</code>的队列当中，而是存放在<code>middleware</code>
中直到该消息被回调函数处理(<strong>这是ros2与ros1最显著的不同之一</strong>)。ros2会创建一个使用二进制标识符(flag)标识的<code>wait set</code>
来说明某个消息是否需要使用回调函数处理。</li>
</ol>
<h3 id="使用方法-1">使用方法</h3>
<h4 id="最简单的使用程序">最简单的使用程序</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// Some initialization.</span></span><br><span class="line">   rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Instantiate a node.</span></span><br><span class="line">   rclcpp::Node::SharedPtr node = ...</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Run the executor.</span></span><br><span class="line">   rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Shutdown and exit.</span></span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在这里我们像ros1中调用了<code>spin</code>函数，但其执行过程与ros1不同，在ros2中，spin函数会默认生成一个<code>SingleThreadedExecutor</code>
的<code>executor</code>，并调用该<code>executor</code>中的<code>spin</code>方法进行消息检测和回调处理</p></li>
<li><p>等效于下列代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rclcpp::executors::SingleThreadedExecutor executor;</span><br><span class="line">executor.<span class="built_in">add_node</span>(node);</span><br><span class="line">executor.<span class="built_in">spin</span>();</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="components">Components</h2>
<h3 id="介绍">介绍</h3>
<blockquote>
<p>ros2中关于ros1<code>nodelet</code>的替代品，保证了接口的统一，使得若干节点运行在<strong>同一进程内</strong>！</p>
<p>ros中实现多个节点的通讯有两种方案：</p>
<ol type="1">
<li>第一种是每个node定义在单独的进程中，这样有助于异常追踪，资源分配，错误隔离</li>
<li>另一种是将若干节点定义在一个进程中，这样有助于获得更低的通讯开销，提高通讯效率</li>
</ol>
</blockquote>
<blockquote>
<ul>
<li>本质是创建了一个<code>Single-Threaded Executor</code>在<code>component-manager</code>
当中，该容器管理器可以动态的加载以动态库形式生成的<code>node</code>，如果node的开启了<code>use_intra_process_comms</code>
（默认传递的nodeoption并未开启），则可以实现线程内通讯(零拷贝！)</li>
<li>即使不是零拷贝，因为使用该方法实现的是线程间通讯，其开销比正常的进程间通讯要小</li>
</ul>
</blockquote>
<h3 id="使用方法-2">使用方法</h3>
<h4 id="命令行调用">命令行调用</h4>
<ol type="1">
<li><p>创建<code>容器管理节点</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run rclcpp_components component_container</span><br></pre></td></tr></table></figure>
<ul>
<li>这会创建一个名为<code>/ComponentManager</code>的节点，如果要创建多个节点，记得使用<code>ros-arg __name=new_name</code>来对节点进行重命名(
ros2中节点重名好像并不会报错～)</li>
<li>可以使用<code>ros2 component list</code>来查看所以的管理容器</li>
</ul></li>
<li><p>加载节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ros2 componet load 管理容器名字 动态库所在功能包名字 待加载的节点类(需要加上命名空间)</span><br><span class="line">ros2 component load /ComponentManager composition composition::Talker</span><br></pre></td></tr></table></figure>
<ul>
<li>可以使用<code>ros2 component types</code>来查看当前可以调用的动态节点类</li>
<li>一旦<code>load</code>之后，节点相关的代码会在<code>容器管理节点中开始运行</code></li>
</ul></li>
</ol>
<h4 id="使用代码的方式调">使用代码的方式调</h4>
<blockquote>
<p>本质上就是加载动态链接库，然后自己编写<code>SingleThreadedExecutor</code>调用这些节点</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2016 Open Source Robotics Foundation, Inc.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">// you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">// You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">// See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">// limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;composition/client_component.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;composition/listener_component.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;composition/talker_component.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;composition/server_component.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Force flush of the stdout buffer.</span></span><br><span class="line">  <span class="built_in">setvbuf</span>(stdout, <span class="literal">NULL</span>, _IONBF, BUFSIZ);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize any global resources needed by the middleware and the client library.</span></span><br><span class="line">  <span class="comment">// This will also parse command line arguments one day (as of Beta 1 they are not used).</span></span><br><span class="line">  <span class="comment">// You must call this before using any other part of the ROS system.</span></span><br><span class="line">  <span class="comment">// This should be called once per process.</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create an executor that will be responsible for execution of callbacks for a set of nodes.</span></span><br><span class="line">  <span class="comment">// With this version, all callbacks will be called from within this thread (the main one).</span></span><br><span class="line">  rclcpp::executors::SingleThreadedExecutor exec;</span><br><span class="line">  rclcpp::NodeOptions options;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add some nodes to the executor which provide work for the executor during its &quot;spin&quot; function.</span></span><br><span class="line">  <span class="comment">// An example of available work is executing a subscription callback, or a timer callback.</span></span><br><span class="line">  <span class="keyword">auto</span> talker = std::<span class="built_in">make_shared</span>&lt;composition::Talker&gt;(options);</span><br><span class="line">  exec.<span class="built_in">add_node</span>(talker);</span><br><span class="line">  <span class="keyword">auto</span> listener = std::<span class="built_in">make_shared</span>&lt;composition::Listener&gt;(options);</span><br><span class="line">  exec.<span class="built_in">add_node</span>(listener);</span><br><span class="line">  <span class="keyword">auto</span> server = std::<span class="built_in">make_shared</span>&lt;composition::Server&gt;(options);</span><br><span class="line">  exec.<span class="built_in">add_node</span>(server);</span><br><span class="line">  <span class="keyword">auto</span> client = std::<span class="built_in">make_shared</span>&lt;composition::Client&gt;(options);</span><br><span class="line">  exec.<span class="built_in">add_node</span>(client);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// spin will block until work comes in, execute work as it becomes available, and keep blocking.</span></span><br><span class="line">  <span class="comment">// It will only be interrupted by Ctrl-C.</span></span><br><span class="line">  exec.<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用路径加载的方式调用">使用路径加载的方式调用</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run composition dlopen_composition `ros2 pkg prefix composition`/lib/libtalker_component.so `ros2 pkg prefix composition`/lib/liblistener_component.so</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此处<code>ros2 pkg prefix composition</code>是调用ros2的cli查看<code>composition</code>的路径并和后续的库相对路径进行拼接形成绝对地址</p>
</blockquote>
<h4 id="使用launch加载">使用launch加载</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Launch a talker and a listener in a component container.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> ComposableNodeContainer</span><br><span class="line"><span class="keyword">from</span> launch_ros.descriptions <span class="keyword">import</span> ComposableNode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Generate launch description with multiple components.&quot;&quot;&quot;</span></span><br><span class="line">    container = ComposableNodeContainer(</span><br><span class="line">            name=<span class="string">&#x27;my_container&#x27;</span>,</span><br><span class="line">            namespace=<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            package=<span class="string">&#x27;rclcpp_components&#x27;</span>,</span><br><span class="line">            executable=<span class="string">&#x27;component_container&#x27;</span>,</span><br><span class="line">            composable_node_descriptions=[</span><br><span class="line">                ComposableNode(</span><br><span class="line">                    package=<span class="string">&#x27;composition&#x27;</span>,</span><br><span class="line">                    plugin=<span class="string">&#x27;composition::Talker&#x27;</span>,</span><br><span class="line">                    name=<span class="string">&#x27;talker&#x27;</span>),</span><br><span class="line">                ComposableNode(</span><br><span class="line">                    package=<span class="string">&#x27;composition&#x27;</span>,</span><br><span class="line">                    plugin=<span class="string">&#x27;composition::Listener&#x27;</span>,</span><br><span class="line">                    name=<span class="string">&#x27;listener&#x27;</span>)</span><br><span class="line">            ],</span><br><span class="line">            output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> launch.LaunchDescription([container])</span><br></pre></td></tr></table></figure>
<h3 id="编写component动态库">编写Component动态库</h3>
<blockquote>
<p>以component实现线程内零拷贝例子进行说明(<a
target="_blank" rel="noopener" href="https://github.com/ros2/demos/tree/humble/composition">参考代码</a>)</p>
</blockquote>
<h4
id="创建功能包加上rclcpp_components的依赖">创建功能包，加上<code>rclcpp_components</code>的依赖</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create --build-type ament_cmake --dependencies rclcpp std_msgs rclcpp_components --destination-directory src/ --library-name produce_node intra_process_container</span><br></pre></td></tr></table></figure>
<ul>
<li>此处建议使用<code>—library-name</code>参数自动生成模板库文件，其中包括相应的cmakelist写法</li>
</ul>
<h4
id="编写component-node库文件线程间零拷贝通讯">编写<code>component node</code>库文件(线程间零拷贝通讯)</h4>
<blockquote>
<p>此处需注意以下内容：</p>
<ol type="1">
<li><p>若想实现线程间通讯，需要在创建节点时开启<code>use_intra_process_comms</code></p></li>
<li><p>若想实现线程间零拷贝，需要使用<code>uintptr_t</code>发布<code>msg</code>，并接受<code>uintptr_t</code>的<code>msg</code></p></li>
<li><p>线程间通讯若想实现零拷贝，必须是同一个<code>execute</code>执行零拷贝相关的所有节点</p></li>
<li><p>生成动态节点类的库文件不需要写<code>main</code>函数，最后要包含<code>#include "rclcpp_components/register_node_macro.hpp"</code>
头文件，并且导出相应的类</p></li>
</ol>
</blockquote>
<pre><code> &gt;
 &gt;    <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RCLCPP_COMPONENTS_REGISTER_NODE(命名空间::类名)</span></span><br><span class="line"><span class="built_in">RCLCPP_COMPONENTS_REGISTER_NODE</span>(intra_process_demo::Consumer)</span><br></pre></td></tr></table></figure></code></pre>
<blockquote>

</blockquote>
<h5 id="消费者">消费者</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cinttypes&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/int32.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"><span class="keyword">namespace</span> intra_process_demo</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Consumer</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Consumer</span>(<span class="type">const</span> rclcpp::NodeOptions &amp;options)</span><br><span class="line">            : <span class="built_in">Node</span>(<span class="string">&quot;consumer&quot;</span>, rclcpp::<span class="built_in">NodeOptions</span>().<span class="built_in">use_intra_process_comms</span>(<span class="literal">true</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Create a subscription on the input topic which prints on receipt of new messages.</span></span><br><span class="line">            sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::Int32&gt;(</span><br><span class="line">                <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                <span class="number">10</span>,</span><br><span class="line">                [<span class="keyword">this</span>](std_msgs::msg::Int32::UniquePtr msg)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(</span><br><span class="line">                        <span class="string">&quot;%s Receive message with value: %d, and address: 0x%&quot;</span> PRIXPTR <span class="string">&quot;\n&quot;</span>, <span class="keyword">this</span>-&gt;<span class="built_in">get_name</span>(), msg-&gt;data,</span><br><span class="line">                        <span class="built_in">reinterpret_cast</span>&lt;std::<span class="type">uintptr_t</span>&gt;(msg.<span class="built_in">get</span>()));</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        rclcpp::Subscription&lt;std_msgs::msg::Int32&gt;::SharedPtr sub_;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// namespace intra_process_container</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_components/register_node_macro.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Register the component with class_loader.</span></span><br><span class="line"><span class="comment">// This acts as a sort of entry point, allowing the component to be discoverable when its library</span></span><br><span class="line"><span class="comment">// is being loaded into a running process.</span></span><br><span class="line"><span class="built_in">RCLCPP_COMPONENTS_REGISTER_NODE</span>(intra_process_demo::Consumer)</span><br></pre></td></tr></table></figure>
<h5 id="生产者">生产者</h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cinttypes&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/int32.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"><span class="keyword">namespace</span> intra_process_demo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Producer</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Producer</span>(<span class="type">const</span> rclcpp::NodeOptions &amp;options)</span><br><span class="line">            : <span class="built_in">Node</span>(<span class="string">&quot;process&quot;</span>, rclcpp::<span class="built_in">NodeOptions</span>().<span class="built_in">use_intra_process_comms</span>(<span class="literal">true</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Create a publisher on the output topic.</span></span><br><span class="line">            pub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;std_msgs::msg::Int32&gt;(<span class="string">&quot;number&quot;</span>, <span class="number">10</span>);</span><br><span class="line">            std::weak_ptr&lt;std::remove_pointer&lt;<span class="keyword">decltype</span>(pub_.<span class="built_in">get</span>())&gt;::type&gt; captured_pub = pub_;</span><br><span class="line">            <span class="comment">// Create a timer which publishes on the output topic at ~1Hz.</span></span><br><span class="line">            <span class="keyword">auto</span> callback = [captured_pub, <span class="keyword">this</span>]() -&gt; <span class="type">void</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">auto</span> pub_ptr = captured_pub.<span class="built_in">lock</span>();</span><br><span class="line">                <span class="keyword">if</span> (!pub_ptr)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">static</span> <span class="type">int32_t</span> count = <span class="number">0</span>;</span><br><span class="line">                std_msgs::msg::<span class="function">Int32::UniquePtr <span class="title">msg</span><span class="params">(<span class="keyword">new</span> std_msgs::msg::Int32())</span></span>;</span><br><span class="line">                msg-&gt;data = count++;</span><br><span class="line">                <span class="built_in">printf</span>(</span><br><span class="line">                    <span class="string">&quot;%s Published message with value: %d, and address: 0x%&quot;</span> PRIXPTR <span class="string">&quot;\n&quot;</span>, <span class="keyword">this</span>-&gt;<span class="built_in">get_name</span>(), msg-&gt;data,</span><br><span class="line">                    <span class="built_in">reinterpret_cast</span>&lt;std::<span class="type">uintptr_t</span>&gt;(msg.<span class="built_in">get</span>()));</span><br><span class="line">                pub_ptr-&gt;<span class="built_in">publish</span>(std::<span class="built_in">move</span>(msg));</span><br><span class="line">            &#125;;</span><br><span class="line">            timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(<span class="number">1</span>s, callback);</span><br><span class="line">        &#125;</span><br><span class="line">        rclcpp::Publisher&lt;std_msgs::msg::Int32&gt;::SharedPtr pub_;</span><br><span class="line">        rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_components/register_node_macro.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Register the component with class_loader.</span></span><br><span class="line"><span class="comment">// This acts as a sort of entry point, allowing the component to be discoverable when its library</span></span><br><span class="line"><span class="comment">// is being loaded into a running process.</span></span><br><span class="line"><span class="built_in">RCLCPP_COMPONENTS_REGISTER_NODE</span>(intra_process_demo::Producer)</span><br></pre></td></tr></table></figure>
<h4 id="cmakelist">CmakeList</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(intra_process_container)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(CMAKE_COMPILER_IS_GNUCXX <span class="keyword">OR</span> CMAKE_CXX_COMPILER_ID <span class="keyword">MATCHES</span> <span class="string">&quot;Clang&quot;</span>)</span><br><span class="line">  <span class="keyword">add_compile_options</span>(-Wall -Wextra -Wpedantic)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_ros REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(rclcpp REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(std_msgs REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(rclcpp_components REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(produce_node SHARED src/produce_node.cpp)</span><br><span class="line"><span class="keyword">target_compile_features</span>(produce_node PUBLIC c_std_99 cxx_std_17)  <span class="comment"># Require C99 and C++17</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(produce_node PUBLIC</span><br><span class="line">  $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">  $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  produce_node</span><br><span class="line">  <span class="string">&quot;rclcpp&quot;</span></span><br><span class="line">  <span class="string">&quot;std_msgs&quot;</span></span><br><span class="line">  <span class="string">&quot;rclcpp_components&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Causes the visibility macros to use dllexport rather than dllimport,</span></span><br><span class="line"><span class="comment"># which is appropriate when building the dll but not consuming it.</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(produce_node PRIVATE <span class="string">&quot;INTRA_PROCESS_CONTAINER_BUILDING_LIBRARY&quot;</span>)</span><br><span class="line">rclcpp_components_register_nodes(produce_node <span class="string">&quot;intra_process_demo::Producer&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(consumer_node SHARED src/consumer_node.cpp)</span><br><span class="line"><span class="keyword">target_compile_features</span>(consumer_node PUBLIC c_std_99 cxx_std_17)  <span class="comment"># Require C99 and C++17</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(consumer_node PUBLIC</span><br><span class="line">  $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">  $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  consumer_node</span><br><span class="line">  <span class="string">&quot;rclcpp&quot;</span></span><br><span class="line">  <span class="string">&quot;std_msgs&quot;</span></span><br><span class="line">  <span class="string">&quot;rclcpp_components&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Causes the visibility macros to use dllexport rather than dllimport,</span></span><br><span class="line"><span class="comment"># which is appropriate when building the dll but not consuming it.</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(consumer_node PRIVATE <span class="string">&quot;INTRA_PROCESS_CONTAINER_BUILDING_LIBRARY&quot;</span>)</span><br><span class="line">rclcpp_components_register_nodes(consumer_node <span class="string">&quot;intra_process_demo::Consumer&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  DIRECTORY <span class="keyword">include</span>/</span><br><span class="line">  DESTINATION <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  TARGETS produce_node</span><br><span class="line">  <span class="keyword">EXPORT</span> export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  TARGETS consumer_node</span><br><span class="line">  <span class="keyword">EXPORT</span> export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span>(BUILD_TESTING)</span><br><span class="line">  <span class="keyword">find_package</span>(ament_lint_auto REQUIRED)</span><br><span class="line">  <span class="comment"># the following line skips the linter which checks for copyrights</span></span><br><span class="line">  <span class="comment"># comment the line when a copyright and license is added to all source files</span></span><br><span class="line">  <span class="keyword">set</span>(ament_cmake_copyright_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line">  <span class="comment"># the following line skips cpplint (only works in a git repo)</span></span><br><span class="line">  <span class="comment"># comment the line when this package is in a git repo and when</span></span><br><span class="line">  <span class="comment"># a copyright and license is added to all source files</span></span><br><span class="line">  <span class="keyword">set</span>(ament_cmake_cpplint_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line">  ament_lint_auto_find_test_dependencies()</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line">ament_export_include_directories(</span><br><span class="line">  <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line">ament_export_libraries(</span><br><span class="line">  produce_node</span><br><span class="line">)</span><br><span class="line">ament_export_libraries(</span><br><span class="line">  consumer_node</span><br><span class="line">)</span><br><span class="line">ament_export_targets(</span><br><span class="line">  export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ament_package()</span><br></pre></td></tr></table></figure>
<h5 id="关键内容">关键内容</h5>
<ol type="1">
<li><p>找到依赖包</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find dependencies</span></span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(ament_cmake_ros REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(rclcpp REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(std_msgs REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(rclcpp_components REQUIRED)</span><br></pre></td></tr></table></figure></li>
<li><p>生成动态库，并关联依赖</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(produce_node SHARED src/produce_node.cpp)</span><br><span class="line"><span class="keyword">target_compile_features</span>(produce_node PUBLIC c_std_99 cxx_std_17)  <span class="comment"># Require C99 and C++17</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(produce_node PUBLIC</span><br><span class="line">  $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">  $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  produce_node</span><br><span class="line">  <span class="string">&quot;rclcpp&quot;</span></span><br><span class="line">  <span class="string">&quot;std_msgs&quot;</span></span><br><span class="line">  <span class="string">&quot;rclcpp_components&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Causes the visibility macros to use dllexport rather than dllimport,</span></span><br><span class="line"><span class="comment"># which is appropriate when building the dll but not consuming it.</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(produce_node PRIVATE <span class="string">&quot;INTRA_PROCESS_CONTAINER_BUILDING_LIBRARY&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>导出<code>component node</code></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclcpp_components_register_nodes(produce_node <span class="string">&quot;intra_process_demo::Producer&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>下载库和依赖文件</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  DIRECTORY <span class="keyword">include</span>/</span><br><span class="line">  DESTINATION <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  TARGETS produce_node</span><br><span class="line">  <span class="keyword">EXPORT</span> export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">  TARGETS consumer_node</span><br><span class="line">  <span class="keyword">EXPORT</span> export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
<li><p>导出ament依赖(方便其他包依赖当前功能包的时候可以找到当前功能包所依赖的文件或库)</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ament_export_include_directories(</span><br><span class="line">  <span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line">ament_export_libraries(</span><br><span class="line">  produce_node</span><br><span class="line">)</span><br><span class="line">ament_export_libraries(</span><br><span class="line">  consumer_node</span><br><span class="line">)</span><br><span class="line">ament_export_targets(</span><br><span class="line">  export_<span class="variable">$&#123;PROJECT_NAME&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ament_package()</span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ROS2/" rel="tag"><i class="fa fa-tag"></i> ROS2</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/undefined/e5334e9d/" rel="prev" title="Clion调试Ros2">
                  <i class="fa fa-angle-left"></i> Clion调试Ros2
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">dl</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">48k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:56</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
